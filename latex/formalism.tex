\title{CESK* / CFA Formalism}
\author{
	Davis Silverman
}
\date{}

\documentclass[12pt,draft]{article}

\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{tikz}
\usepackage{titling}
\usepackage{multicol}
\usepackage[margin=1in]{geometry}

\setlength{\columnsep}{0cm} % Column separation from multicol
%\setlength{\droptitle}{-10cm}  % Make title not in middle of page (uses titling package)
\def\checkmark{\tikz\fill[scale=0.4](0,.35) -- (.25,0) -- (1,.7) -- (.25,.15) -- cycle;}

% \setcounter{section}{-1} % sets the first section number to 0
\newcommand\mdoubleplus{\ensuremath{\mathbin{+\mkern-9mu+}}}
\newcommand\mae{\ensuremath{\text{\ae}}}
\newcommand{\lamsyn}[2]{(\lambda\;(#1 ...)\;#2)}
\newcommand{\singlelamsyn}[2]{(\lambda\;(#1)\;#2)}
\newcommand{\vararglamsyn}[2]{(\lambda\;#1\;#2)}
\newcommand{\letsyn}[3]{(\texttt{let}\;([#1\;#2]\;...)\;#3)}
\newcommand{\ifsyn}[3]{(\texttt{if}\;#1\;#2\;#3)}
\newcommand{\primsyn}[2]{(\texttt{prim}\;#1\;#2\;...)}
\newcommand{\singleprimsyn}[1]{(\texttt{prim}\;#1)}
\newcommand{\applyprimsyn}[2]{(\texttt{apply-prim}\;#1\;#2)}
\newcommand{\applysyn}[2]{(\texttt{apply}\;#1\;#2)}
\newcommand{\callccsyn}[1]{(\texttt{call/cc}\;#1)}
\newcommand{\setsyn}[2]{(\texttt{set!}\;#1\;#2)}
\newcommand{\quotesyn}[1]{(\texttt{quote}\;#1)}

\newcommand{\truesyn}{\texttt{\#t}}
\newcommand{\falsesyn}{\texttt{\#f}}


\newcommand{\ctrl}[0]{e_{\varsigma}}
\newcommand{\env}[0]{\rho}
\newcommand{\store}[0]{\sigma}
\newcommand{\baddr}[0]{a}
\newcommand{\kaddr}[0]{a_{\kappa}}
\newcommand{\kont}[0]{\kappa}
\newcommand{\state}[0]{\varsigma}
\newcommand{\E}[4]{E\langle #1 , #2 , #3 , #4 \rangle}
\newcommand{\A}[4]{A\langle #1 , #2 , #3 , #4 \rangle}

\begin{document}
% \maketitle


% textsf for syntactic domains
% textit for semantic domains
% \maketitle





%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%% CONCRETE SEMANTICS %%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%% FLAT CLOSURES %%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\newcommand{\cExp}[0]{\textsf{Exp}}
\newcommand{\cVar}[0]{\textsf{Var}}
\newcommand{\cCall}[0]{\textsf{Call}}
\newcommand{\cApply}[0]{\textsf{Apply}}
\newcommand{\cLet}[0]{\textsf{Let}}
\newcommand{\cLam}[0]{\textsf{Lam}}
\newcommand{\cState}[0]{\Sigma}
\newcommand{\cstate}[0]{\varsigma}
\newcommand{\cStore}[0]{\textit{Store}}
\newcommand{\cBAddr}[0]{\textit{BAddr}}
\newcommand{\cKAddr}[0]{\textit{KAddr}}
\newcommand{\cVal}[0]{\textit{Val}}
\newcommand{\cKont}[0]{\textit{Kont}}
\newcommand{\ckont}[0]{\kappa}
\newcommand{\cEnv}[0]{\textit{Env}}
\newcommand{\cenv}[0]{\rho}
\newcommand{\cstore}[0]{\sigma}
\newcommand{\ckaddr}[0]{a_{\kappa}}
\newcommand{\cClo}[0]{\textit{Clo}}
\newcommand{\cinj}[0]{inj}
\newcommand{\cnewenv}[0]{new\rho}
\newcommand{\cPrim}[0]{\textsf{Prim}}
\newcommand{\ccalllist}[0]{\overrightarrow{call}}

\begin{multicols*}{2}
  [
  \begin{center}
    \textbf{Concrete Scheme CESK* With Flat Closures} \\
  \end{center}
  ]
  %%%%%%%%%%%%%%%%%%%%%%%%%%%%% DOMAINS %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  \noindent
  \textbf{Syntactic Domains}
  \begin{align*}
    e \in \cExp &::= \mae \\
                & |\; \ifsyn{e}{e}{e} \;|\; \setsyn{x}{e} \\
                &|\; \callccsyn{e} \\
                &|\; apply \;|\; let \;|\; call \\
    \mae \in \textsf{AExp} &::= x \;|\; lam \;|\; op \\
                &|\; \quotesyn{e} \;|\; b \;|\; n \\
    n \in \mathbb{Z} &\\
    b \in \mathbb{B} &\triangleq \{\truesyn , \falsesyn\} \\
    x \in \cVar &\triangleq \text{The set of identifiers} \\
    op \in \cPrim &\triangleq \text{The set of prims} \\
    apply \in \cApply &::= \applysyn{e}{e} \\
    call \in \cCall &::= (e \; e \; ...) \\
    let \in \cLet &::= \letsyn{x}{e}{e} \\
    lam \in \cLam &::= (\lambda \; (x) \; e) \;|\; (\lambda \; x \; e)
  \end{align*}
  %%%%%%%%%%%%%%%%%%%%%%%%%
  %%%%% COLUMN BREAK %%%%%%
  %%%%%%%%%%%%%%%%%%%%%%%%%
  \vfill\null
  \columnbreak
  %%%%%%%%%%%%%%%%%%%%%%%%%
  %%%%% COLUMN BREAK %%%%%%
  %%%%%%%%%%%%%%%%%%%%%%%%%
  \noindent
  \textbf{Semantic Domains}
  \begin{align*}
    \cstate \in \cState &\triangleq E\langle \textit{Eval} \rangle
                          + A\langle \textit{Apply} \rangle \\
    \textit{Eval} &\triangleq \cExp \times \cEnv \times \cStore \times \cKAddr \\
    \textit{Apply} &\triangleq \cVal \times \cEnv \times \cStore \times \cKAddr \\
    \cenv \in \cEnv &\triangleq \mathbb{N} \times \cExp^* \\
    \cstore \in \cStore &\triangleq \cBAddr
                                 \rightharpoonup \cVal \\
    & \times \cKAddr \rightharpoonup \cKont \\
    a \in \cBAddr &\triangleq \cVar \times \cEnv \\
    \ckaddr \in \cKAddr &\triangleq \mathbb{N} \\
    v \in \cVal &\triangleq \cClo + \mathbb{Z} + \mathbb{B} \\
                        & + \cPrim + \cKont \\
                        & + \{\textbf{quote}(e) , \textbf{cons}(v , v) ,
                          \textit{Void}\} \\
    clo \in \cClo &\triangleq \cLam \times \cEnv \\
    \ckont \in \cKont &::= \textbf{mt} \\
                        &|\; \textbf{ifk}(e , e , \cenv , \ckaddr) \\
                        &|\; \textbf{setk}(a, \ckaddr) \\
                        &|\; \textbf{callcck}(\callccsyn{e} , \ckaddr) \\
                        &|\; \textbf{applyk}(apply, v? , e , \cenv , \ckaddr) \\
                        &|\; \textbf{callk}(call,done,todo,\cenv,\ckaddr) \\
    done &\in \cVal^* \\
    todo &\in \cExp* \\
  \end{align*}
\end{multicols*}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%% CONCRETE FLAT SEMANTICS %%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%  MORE FUNCTIONS %%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage

\begin{multicols*}{2}
  [
  \begin{center}
    \textbf{Useful Functions}
  \end{center}
  ]
  \noindent
  \textbf{Callable helper function}
  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% CALLFUNC  DEFINITION %%%%%%%%%%%%%%%%%%%%%%
  \begin{center}
    $ CALL : \cVal \times \cVal^* \times \cEnv$
    $\times \; \cStore \times \cExp \times \cKAddr \rightarrow \cState $ \\
  \end{center}
  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% CALLFUNC MULTIARG %%%%%%%%%%%%%%%%%%%%%%%%%
  \begin{center}
    $CALL(clo , \overrightarrow{v} , \cenv , \cstore , e, \ckaddr)
            \triangleq \E{e_b}{\cenv'}{\cstore'}{\ckaddr}$
  \end{center}
  \vspace{-7mm}
  \begin{align*}
    \text{where }
    clo &= ((\lambda \; (x \; ...) \; e_b) , \cenv_{\lambda}) \\
    \cenv' &\triangleq \cnewenv(e , \cenv) \\
    a_{x_i} &\triangleq (x_i , \cenv') \\
    x_j' &\triangleq free((\lambda \; (x \; ...) \; e_b)) \\
    a_{x_j'} &\triangleq (x_j' , \cenv') \\
    \cstore' &\triangleq \cstore
               \sqcup [a_{x_i} \mapsto \overrightarrow{v_i}]
               \sqcup [a_{x_j'} \mapsto \cstore(x_j' , \cenv_{\lambda})]
  \end{align*}
  %%%%%%%%%%%%%%%%%%%%%%%%%%%% CALLFUNC VARARG %%%%%%%%%%%%%%%%%%%%%%%%
  \begin{center}
    $CALL(clo , \overrightarrow{v} , \cenv , \cstore , e , \ckaddr)
             \triangleq \E{e_b}{\cenv'}{\cstore'}{\ckaddr}$ \\
  \end{center}
  \vspace{-7mm}
  \begin{align*}
    \text{where }
    clo &= ((\lambda \; x \; e_b) , \cenv_{\lambda}) \\
    \cenv' &\triangleq \cnewenv(e , \cenv) \\
    a_x &\triangleq (x , \cenv') \\
    x_j' &\triangleq free((\lambda \; x \; e_b)) \\
    a_{x_j'} &\triangleq (x_j' , \cenv') \\
    \cstore' &\triangleq \cstore
               \sqcup [a_x \mapsto \overrightarrow{v}]
               \sqcup [a_{x_j'} \mapsto \cstore(x_j' , \cenv_{\lambda})]
  \end{align*}
  %%%%%%%%%%%%%%%%%%%%%%%%%%%% CALLFUNC KONT %%%%%%%%%%%%%%%%%%%%%%%%%
  \begin{center}
    $CALL(\kappa , [v] , \cenv , \cstore , e , \_)
           \triangleq \A{v}{\cenv}{\cstore'}{\ckaddr} $
  \end{center}
  \vspace{-7mm}
  \begin{align*}
    \text{where }
    \ckaddr &\triangleq |\cstore| \\
    \cstore' &\triangleq \cstore \sqcup [\ckaddr \mapsto \kappa]
  \end{align*}
  %%%%%%%%%%%%%%%%%%%%%%%%%%%% CALLFUNC PRIM %%%%%%%%%%%%%%%%%%%%%%%%%
  \begin{center}
    $CALL(op , \overrightarrow{v} , \cenv , \cstore , \_ , \ckaddr)
    \triangleq \A{v}{\cenv}{\cstore}{\ckaddr}$ \\
  \end{center}
  \vspace{-7mm}
  \begin{align*}
    \text{where }
    v &\triangleq op \text{ applied to } \overrightarrow{v}
  \end{align*}
  %%%%%%%%%%%%%%%%%%%%%%%%%
  %%%%% COLUMN BREAK %%%%%%
  %%%%%%%%%%%%%%%%%%%%%%%%%
  \vfill\null
  \columnbreak
  %%%%%%%%%%%%%%%%%%%%%%%%%
  %%%%% COLUMN BREAK %%%%%%
  %%%%%%%%%%%%%%%%%%%%%%%%%
  \noindent \textbf{Injection} \\
  \vspace{-7mm}
  \begin{center}
    $\cinj : \cExp \rightarrow \cState$ \\
    $\cinj(e) \triangleq
    (e , (0 , \epsilon) , \{0 : \textbf{mt} \} , 0)$
  \end{center}
  \textbf{Allocation} \\
  \vspace{-3mm}
  \begin{align*}
    \cnewenv : \cExp &\times \cEnv \rightarrow \cEnv \\
    \cnewenv(e , (n,\overrightarrow{e})) &\triangleq (n+1, e::\overrightarrow{e})
  \end{align*}
  \textbf{Atomic Evaluation} \\
  \vspace{-3mm}
  \begin{align*}
    \mathcal{A} : \textit{Eval} &\rightarrow \cVal \\
    \mathcal{A}(\E{n}{\_}{\_}{\_}) &\triangleq n \\
    \mathcal{A}(\E{b}{\_}{\_}{\_}) &\triangleq b \\
    \mathcal{A}(\E{\quotesyn{e}}{\_}{\_}{\_}) &\triangleq \textbf{quote}(e) \\
    \mathcal{A}(\E{op}{\cenv}{\cstore}{\_})
                                &\triangleq op \text{ when }
                                  (op , \cenv) \not\in \cstore \\
    \mathcal{A}(\E{lam}{\cenv}{\_}{\_}) &\triangleq (lam , \cenv) \\
    \mathcal{A}(\E{x}{\cenv}{\cstore}{\_}) &\triangleq \cstore(x , \cenv)
  \end{align*}
  \textbf{Store Joining} \\
  \vspace{-3mm}
  \begin{align*}
    \sigma \sqcup [a \mapsto v] &\triangleq \sigma[a \mapsto v]
  \end{align*}
\end{multicols*}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%% CONCRETE FLAT SEMANTICS %%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%% PAGE 1 (EVAL) %%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage

\begin{multicols*}{2}
  [
  \begin{center}
    \textbf{Eval Semantics}
  \end{center}
  ]
  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%% ATOMIC EXP %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  \begin{center}
    $\E{\mae}{\cenv}{\cstore}{\ckaddr}$
    $\leadsto \A{v}{\cenv}{\cstore}{\ckaddr}$
  \end{center}
  \vspace{-7mm}
  \begin{align*}
    \text{where } v &\triangleq \mathcal{A}(\varsigma)
  \end{align*}
  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% IF CONDITIONAL %%%%%%%%%%%%%%%%%%%%%%%%
  \begin{center}
    $\E{\ifsyn{e_c}{e_t}{e_f}}{\cenv}{\cstore}{\ckaddr}$
    $\leadsto \E{e_c}{\cenv}{\cstore'}{\ckaddr'}$
  \end{center}
  \vspace{-7mm}
  \begin{align*}
    \text{where }
    \ckaddr' &\triangleq |\cstore| \\
    \ckont &\triangleq \textbf{ifk}(e_t , e_f , \cenv , \ckaddr) \\
    \cstore' &\triangleq \cstore \sqcup [\ckaddr' \mapsto \ckont]
  \end{align*}
  %%%%%%%%%%%%%%%%%%%%%%%%%%%% LET BECOMES CALL %%%%%%%%%%%%%%%%%%%%%%%%
  \begin{center}
    $\E{let}{\cenv}{\cstore}{\ckaddr}$
    $\leadsto \E{call}{\cenv}{\cstore}{\ckaddr}$
  \end{center}
  \vspace{-7mm}
  \begin{align*}
    \text{where }
    let &= (\texttt{let} \; ([x_s \; e_s] \; ...) \; e_b) \\
    call &= ((\lambda \; (x_s \; ...) \; e_b) \; e_s)
  \end{align*}
  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% SET MUTATION %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  \begin{center}
    $\E{\setsyn{x}{e}}{\cenv}{\cstore}{\ckaddr}$
    $\leadsto \E{e}{\cenv}{\cstore'}{\ckaddr'}$
  \end{center}
  \vspace{-7mm}
  \begin{align*}
    \text{where }
    a &\triangleq (x , \cenv) \\
    \ckaddr' &\triangleq |\cstore| \\
    \ckont &\triangleq \textbf{setk}(a , \ckaddr) \\
    \cstore' &\triangleq \cstore \sqcup [\ckaddr' \mapsto \ckont]
  \end{align*}
  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% CALL/CC BECOMES CALL %%%%%%%%%%%%%%%%%%%
  \begin{center}
    $\E{\callccsyn{e}}{\cenv}{\cstore}{\ckaddr}$
    $\leadsto \E{e}{\cenv}{\cstore'}{\ckaddr'}$
  \end{center}
  \vspace{-7mm}
  \begin{align*}
    \text{where }
    \ckaddr' &\triangleq |\cstore| \\
    \ckont &\triangleq \textbf{callcck}(\callccsyn{e} , \ckaddr) \\
    \cstore' &\triangleq \cstore \sqcup [\ckaddr' \mapsto \ckont]
  \end{align*}
  %%%%%%%%%%%%%%%%%%%%%%%%%
  %%%%% COLUMN BREAK %%%%%%
  %%%%%%%%%%%%%%%%%%%%%%%%%
  \vfill\null
  \columnbreak
  %%%%%%%%%%%%%%%%%%%%%%%%%
  %%%%% COLUMN BREAK %%%%%%
  %%%%%%%%%%%%%%%%%%%%%%%%%
  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% APPLY %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  \begin{center}
    $\E{\applysyn{e_f}{e}}{\cenv}{\cstore}{\ckaddr}$
    $\leadsto \E{e_f}{\cenv}{\cstore'}{\ckaddr'}$
  \end{center}
  \vspace{-7mm}
  \begin{align*}
    \text{where }
    \ckaddr' &\triangleq |\cstore| \\
    \ckont &\triangleq \textbf{applyk}(\applysyn{e_f}{e} , \varnothing ,
             e , \cenv , \ckaddr) \\
    \cstore' &\triangleq \cstore \sqcup [\ckaddr' \mapsto \ckont]
  \end{align*}
  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% UNTAGGED CALL %%%%%%%%%%%%%%%%%%%%%%%%%%
  \begin{center}
    $\E{(e_f \; e_s \; ...)}{\cenv}{\cstore}{\ckaddr}$
    $\leadsto \E{e_f}{\cenv}{\cstore'}{\ckaddr'}$
  \end{center}
  \vspace{-7mm}
  \begin{align*}
    \text{where }
    \ckaddr' &\triangleq |\cstore| \\
    \ckont &\triangleq \textbf{callk}((e_f \; e_s \; ...) , \epsilon
             , e_s , \cenv , \ckaddr) \\
    \cstore' &\triangleq \cstore \sqcup [\ckaddr' \mapsto \ckont]
  \end{align*}
  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% NAME %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  \begin{center}
  \end{center}
  \vspace{-7mm}
  \begin{align*}
  \end{align*}
\end{multicols*}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%% CONCRETE FLAT SEMANTICS %%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%% PAGE 2 (APPLY 1) %%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage

\begin{multicols*}{2}
  [
  \begin{center}
    \textbf{Apply Semantics} \\
  \end{center}
  ]
  %%%%%%%%%%%%%%%%%%%%%%%%%%%%% DONE %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  \begin{center}
    $ A\langle \cstate \rangle \leadsto A\langle \cstate \rangle $
  \end{center}
  \vspace{-7mm}
  \begin{align*}
    \text{where }
    \cstore(\ckaddr) &= \textbf{mt}
  \end{align*}
  %%%%%%%%%%%%%%%%%%%%%%%%%%%%% IF TRUE %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  \begin{center}
    $\A{v}{\cenv}{\cstore}{\ckaddr}$
    $\leadsto \E{e_t}{\cenv_\ckont}{\cstore}{\ckaddr'}$
  \end{center}
  \vspace{-7mm}
  \begin{align*}
    \text{where }
    \cstore(\ckaddr) &= \textbf{ifk}(e_t , \_ , \cenv_{\ckont} , \ckaddr') \\
    v &\not= \falsesyn
  \end{align*}
  %%%%%%%%%%%%%%%%%%%%%%%%%%%%% IF FALSE %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  \begin{center}
    $\A{v}{\cenv}{\cstore}{\ckaddr}$
    $\leadsto \E{e_f}{\cenv_\ckont}{\cstore}{\ckaddr'}$
  \end{center}
  \vspace{-7mm}
  \begin{align*}
    \text{where }
    \cstore(\ckaddr) &= \textbf{ifk}(\_ , e_f , \cenv_{\ckont} , \ckaddr') \\
    v &= \falsesyn
  \end{align*}
  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% SET MUTATION %%%%%%%%%%%%%%%%%%%%%%%%%%%%
  \begin{center}
    $\A{v}{\cenv}{\cstore}{\ckaddr}$
    $\leadsto \A{\textit{Void}}{\cenv}{\cstore'}{\ckaddr'}$
  \end{center}
  \vspace{-7mm}
  \begin{align*}
    \text{where }
    \cstore(\ckaddr) &= \textbf{setk}(a , \ckaddr') \\
    \cstore' &\triangleq \cstore \sqcup [a \mapsto v]
  \end{align*}
  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% CALLCC %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  \begin{center}
    $\A{v}{\cenv}{\cstore}{\ckaddr}$
    $\leadsto \cstate'$
  \end{center}
  \vspace{-7mm}
  \begin{align*}
    &\text{where} \\
    \cstore(\ckaddr) &= \textbf{callcck}(e , \ckaddr') \\
    \cstate' &\triangleq CALL(v , [\cstore(\ckaddr')] ,
               \cenv , \cstore , e , \ckaddr') \\
  \end{align*}
  %%%%%%%%%%%%%%%%%%%%%%%%%
  %%%%% COLUMN BREAK %%%%%%
  %%%%%%%%%%%%%%%%%%%%%%%%%
  \vfill\null
  \columnbreak
  %%%%%%%%%%%%%%%%%%%%%%%%%
  %%%%% COLUMN BREAK %%%%%%
  %%%%%%%%%%%%%%%%%%%%%%%%%
  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% APPLY TODO %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  \begin{center}
    $\A{v}{\cenv}{\cstore}{\ckaddr}$
    $\leadsto \E{e}{\cenv_{\ckont}}{\cstore'}{\ckaddr''}$
  \end{center}
  \vspace{-7mm}
  \begin{align*}
    \text{where }
    \cstore(\ckaddr) &= \textbf{applyk}(apply , \varnothing , e ,
                       \cenv_{\ckont} , \ckaddr') \\
    \ckaddr'' &\triangleq |\cstore| \\
    \ckont &\triangleq \textbf{applyk}(apply , v , e , \cenv_{\ckont} , \ckaddr') \\
    \cstore' &\triangleq \cstore \sqcup [\ckaddr'' \mapsto \ckont]
  \end{align*}
  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% APPLY DONE MULTIARG %%%%%%%%%%%%%%%%%%%%%%%%
  \begin{center}
    $\A{v}{\cenv}{\cstore}{\ckaddr}$
    $\leadsto \cstate'$
  \end{center}
  \vspace{-7mm}
  \begin{align*}
    \text{where }
    \cstore(\ckaddr) &= \textbf{applyk}(apply , v_f , \_ ,
                       \_ , \ckaddr') \\
    \cstate' &\triangleq CALL(v_f , v , \cenv , \cstore , apply , \ckaddr')
  \end{align*}
  %%%%%%%%%%%%%%%%%%%%%%%%%% CALLK TODO %%%%%%%%%%%%%%%%%%%%%%%%%%%%
  \begin{center}
    $\A{v}{\cenv}{\cstore}{\ckaddr}$
    $\leadsto \E{e_h}{\cenv_{\kappa}}{\cstore'}{\ckaddr''}$
  \end{center}
  \vspace{-7mm}
  \begin{align*}
    &\text{where} \\
    \cstore(\ckaddr) &= \textbf{callk}(call, done , e_h::e_t ,
                       \cenv_{\ckont} , \ckaddr') \\
    \ckaddr'' &\triangleq |\cstore| \\
    \ckont &\triangleq \textbf{callk}(call, done \mdoubleplus [v] ,
             e_t , \cenv_{\ckont} , \ckaddr') \\
    \cstore' &\triangleq \cstore \sqcup [\ckaddr'' \mapsto \ckont]
  \end{align*}
  %%%%%%%%%%%%%%%%%%%%%%%%% CALLK DONE MULTIARG %%%%%%%%%%%%%%%%%%%%%%%%%%%%
  \begin{center}
    $\A{v}{\cenv}{\cstore}{\ckaddr}$
    $\leadsto \cstate' $
  \end{center}
  \vspace{-7mm}
  \begin{align*}
    &\text{where} \\
    \cstore(\ckaddr) &= \textbf{callk}(call, done ,
                       \epsilon , \_ , \ckaddr') \\
    done \mdoubleplus [v] &= v_h :: \overrightarrow{v} \\
    \cstate' &\triangleq CALL(v_h , \overrightarrow{v} \mdoubleplus [v] ,
               \cenv , \cstore , call , \ckaddr') \\
  \end{align*}
\end{multicols*}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%% ABSTRACT SEMANTICS %%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newcommand{\aenv}[0]{\hat{\rho}}
\newcommand{\astore}[0]{\hat{\sigma}}
\newcommand{\aval}[0]{\hat{v}}
\newcommand{\aclo}[0]{\widehat{clo}}
\newcommand{\abaddr}[0]{\hat{a}}
\newcommand{\akaddr}[0]{\hat{a}_{\hat{\kappa}}}
\newcommand{\aballoc}[1]{\widehat{balloc}(#1)}
\newcommand{\akalloc}[1]{\widehat{kalloc}(#1)}
\newcommand{\akont}[0]{\hat{\kappa}}
\newcommand{\ectrl}[0]{e_{\hat{\varsigma}}}
\newcommand{\adone}[0]{\widehat{done}}
\newcommand{\actrladdr}[0]{\hat{a}_{\kappa\varsigma}}
\newcommand{\actrlkont}[0]{\kappa_{\varsigma}}

\newpage
\section{Abstract Semantics of Scheme}

\begin{multicols*}{2}
  [
  \begin{center}
    \textbf{Abstract Semantic Domains:}
  \end{center}
  \vspace{-15mm}
  ]
  \begin{align*}
    \vspace{-10mm}
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% ABSTRACT STATE %%%%%%%%%%%%%%%%%%%%%%%
    \hat{\varsigma} \in \hat{\Sigma}
    &\triangleq E\langle \textit{Eval} \rangle + E\langle \textit{Apply} \rangle\\
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% ABSTRACT EVAL STATE %%%%%%%%%%%%%%%%%%
    Eval &\triangleq \textsf{Exp}
           \times \widehat{\textit{Env}}
           \times \widehat{\textit{Store}}
           \times \widehat{\textit{KAddr}} \\
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% ABSTRACT APPLY STATE %%%%%%%%%%%%%%%%%
    Apply &\triangleq \widehat{\textit{Val}}
            \times \widehat{\textit{Store}} \times \widehat{\textit{KAddr}} \\
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% ABSTRACT ENV %%%%%%%%%%%%%%%%%%%%%%%%%
    \aenv \in \widehat{\textit{Env}}
    &\triangleq \textsf{Var} \rightharpoonup \widehat{\textit{Addr}} \\
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% ABSTRACT STORE %%%%%%%%%%%%%%%%%%%%%%%%%
    \astore \in \widehat{\textit{Store}}
    &\triangleq \widehat{\textit{BAddr}} \rightharpoonup \widehat{\textit{Val}} \\
    &\times \widehat{KAddr} \rightharpoonup \mathcal{P}(\widehat{\textit{Kont}}) \\
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% ABSTRACT VALUE %%%%%%%%%%%%%%%%%%%%%%%%%
    \aval \in \widehat{\textit{Val}} &\triangleq
                                       (\widehat{\textit{CVal}} + \top + \bot)
                                       \times \mathcal{P}(\widehat{\textit{Clo}}) \\
    \hat{cv} \in \widehat{\textit{CVal}}
    &\triangleq \widehat{\textit{Kont}} + \mathbb{Z} \\
    &+ \{\truesyn , \falsesyn , \textit{Null} , \textit{Void}\} \\
    &+ \{\textbf{quote}(e) , \textbf{cons}(\aval, \aval)\} \\
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% ABSTRACT CLO %%%%%%%%%%%%%%%%%%%%%%%%%%%
    \aclo \in \widehat{\textit{Clo}}
    &\triangleq \textsf{Lam} \times \widehat{\textit{Env}} \\
    %%%%%%%%%%%%%%%%%%%%%%%%% ABSTRACT ADDRESSES %%%%%%%%%%%%%%%%%%%%%%%%%
    \abaddr \in \widehat{\textit{BAddr}}
    &\triangleq
      \textsf{Var} \times \textsf{Expr} \\
    \akaddr \in \widehat{\textit{KAddr}}
    &\triangleq
      \textsf{Expr} \times \widehat{\textit{Env}} \\
    %%%%%%%%%%%%%%%%%%%%%%%%% OTHER ABSTRACT VARIABLES %%%%%%%%%%%%%%%%%%%%%%%%%
    \adone &\triangleq \widehat{\textit{Val}}^*
                     \end{align*}
  \begin{center}
    \textbf{Abstract Atomic Evaluation:} \\
    $\mathcal{A} : \textit{Eval} \rightarrow \widehat{\textit{Val}}$
  \end{center}
  \vspace{-7mm}
  \begin{align*}
    \mathcal{A}(E\langle lam , \aenv , ... \rangle)
    &\triangleq (\bot , \{(lam , \aenv)\}) \\
    \mathcal{A}(\mae)
    &\triangleq (\mae , \emptyset) \\
  \end{align*}
  %%%%%%%%%%%%%%%%%%%%%%%%%
  %%%%% COLUMN BREAK %%%%%%
  %%%%%%%%%%%%%%%%%%%%%%%%%
  \vfill\null
  \columnbreak
  %%%%%%%%%%%%%%%%%%%%%%%%%
  %%%%% COLUMN BREAK %%%%%%
  %%%%%%%%%%%%%%%%%%%%%%%%%
  \begin{align*}
    %%%%%%%%%%%%%%%%%%%%%%%%% ABSTRACT KONTINUATIONS %%%%%%%%%%%%%%%%%%%%%%%%%
    \hat{\kappa} \in \widehat{\textit{Kont}}
    &::= \textbf{mt} \\
    &|\; \textbf{ifk}(e, e, \aenv, \akaddr) \\
    &|\; \textbf{letk}(e, vars, \adone, todo, e , \aenv, \akaddr) \\
    &|\; \textbf{callcck}(e, \akaddr) \\
    &|\; \textbf{setk}(\abaddr, \akaddr) \\
    &|\; \textbf{primk}(op, \adone, todo, \aenv, \akaddr) \\
    &|\; \textbf{appprimk}(op, \akaddr) \\
    &|\; \textbf{appk}(e, \adone, todo, \aenv, \akaddr) \\
    &|\; \textbf{appappk}(e, \aval?, e, \aenv, \akaddr) \\
  \end{align*}
  \begin{center}
    \textbf{Allocation:}
  \end{center}
  \vspace{-7mm}
  \begin{align*}
    \widehat{balloc}:\textsf{Var} \times \widehat{\textit{Env}} &\rightarrow \widehat{\textit{BAddr}} \\
    \widehat{balloc}(x, \aenv) &\triangleq (x, \aenv) \\
    \widehat{kalloc}:\textsf{Expr} \times \widehat{\textit{Env}} &\rightarrow \widehat{\textit{KAddr}} \\
    \widehat{kalloc}(e, \hat{\rho}) &\triangleq (e, \hat{\rho}) \\
    \widehat{new\rho}:\textsf{Lam} \times \widehat{\textit{Env}}
    \times \textsf{Lam} &\times \widehat{\textit{Env}}
                          \rightarrow \widehat{\textit{Env}} \\
    \widehat{new\rho}(e_{call} , \aenv , e_{\lambda} , \aenv') &\triangleq
  \end{align*}
  \vspace{-6mm}
  \[
    \;\;\;\;\;\;\;\;\;\;\;\;\;\;\begin{cases}
      first_m(call:\aenv) & e_{\lambda}\text{ is proc}\\
      \aenv' & e_{\lambda}\text{ is kont}
    \end{cases}
  \]
%%%%%%%%%%%%%%%%%%%%%%%%% STORE JOIN SEMANTICS %%%%%%%%%%%%%%%%%%%%%%%%%
  \begin{center}
    \textbf{Store Joining:} \\
    $\;\store \sqcup [\akaddr \mapsto \akont]
    \triangleq \store[\akaddr \mapsto \store(\akaddr) \cup \{\akont\}]$ \\
    $\store \sqcup [a \mapsto (\hat{cv}_i, \widehat{clo}_i)] \triangleq$ \\
    match on $\store[a]$
  \end{center}
  \[
    \store[a \mapsto \begin{cases}
      (\hat{cv}_i, \widehat{clo}_i)
      & \text{if}\;\; \texttt{empty} \\
      (\hat{cv}_i , \widehat{clo}_i \cup \widehat{clo}_e)
      & \text{if}\;\; (\bot, \widehat{clo}_e) \\
      (\hat{cv}_e , \widehat{clo}_i \cup \widehat{clo}_e))
      & \text{if}\;\; (\hat{cv}_e, \widehat{clo}_e) \\
      &\;\;\; \land \; \hat{cv}_i = \bot \\
      (\hat{cv}_i , \widehat{clo}_i \cup \widehat{clo}_e)
      & \text{if}\;\; (\hat{cv}_e , \widehat{clo}_e) \\
      &\;\;\; \land \; \hat{cv}_i = \hat{cv}_e \\
      (\top , \widehat{clo}_i \cup \widehat{clo}_e)
      & \text{if}\;\; (\_, \widehat{clo}_e)
    \end{cases}]
  \]
\end{multicols*}

\newpage

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%% BEGIN ABSTRACT EVAL SEMANTICS %%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\footnotesize{
\begin{multicols*}{2}
[
\begin{center}
\textbf{Abstract Eval Rules} \\
Rules for when the control is an expression \\
\vspace{2mm}
$\hat{\varsigma} = \E{\ectrl}{\aenv}{\astore}{\akaddr}$ \\
Proceed by matching on $\ectrl$ \\
%%%%%%%%%%%%%%%%%%%%%%%%% ATOMIC EVALUATION %%%%%%%%%%%%%%%%
\vspace{2mm}
$\mae \leadsto \A{\aval}{\astore}{\akaddr}{}$ \\
where $\aval \triangleq \hat{\mathcal{A}}(\hat{\varsigma})$
\end{center}
]
%%%%%%%%%%%%%%%%%%%%%%%%% IF EXPRESSION %%%%%%%%%%%%%%%%%%%%%%%%%
\begin{center}
  $ \ifsyn{e_c}{e_t}{e_f} $
  $\leadsto \E{e_c}{\aenv}{\astore'}{\akaddr}$
\end{center}
\vspace{-7mm}
\begin{align*}
  \text{where } \akaddr' &\triangleq \akalloc{\ectrl , \aenv} \\
  \akont &\triangleq \textbf{ifk}(e_t, e_f, \aenv , \akaddr) \\
  \astore' &\triangleq \astore \sqcup [\akaddr' \mapsto \akont]
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%% LET EXPRESSION NO ARGSVALS %%%%%%%%%%%%%%%%%%%
\begin{center}
  $(\texttt{let}\;()\;e_b)$
  $\leadsto \E{e_b}{\aenv}{\astore}{\akaddr}$
\end{center}
%%%%%%%%%%%%%%%%%%%%%%%%% LET EXPRESSION VALS GOT ARGS %%%%%%%%%%%%%%%
\begin{center}
  $(\texttt{let}\;bnds\;e_b)$
  $\leadsto \E{e_0}{\aenv}{\astore'}{\akaddr'}$
\end{center}
\vspace{-7mm}
\begin{align*}
  \text{where }
  bnds &= ([x_0\;e_0]\;[x_s\;e_s]\;...) \\
  \akaddr' &\triangleq \akalloc{\ectrl , \aenv} \\
  \akont &\triangleq \textbf{letk}(\ectrl, x_0::x_s , [\;], \\
  &\;\;\;\;\;\;\;\;\;\;\;\;\;e_s, e_b , \aenv , \akaddr) \\
  \astore' &\triangleq \astore \sqcup [\akaddr' \mapsto \akont]
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%% CALL/CC EXPRESSION %%%%%%%%%%%%%%%%%%%%%%%%%
\begin{center}
  $\callccsyn{e}$
  $\leadsto \E{e}{\aenv}{\astore'}{\akaddr'}$
\end{center}
\vspace{-7mm}
\begin{align*}
  \text{where }
  \akaddr' &\triangleq \akalloc{\ectrl , \aenv} \\
  \akont &\triangleq \textbf{callcck}(\ectrl , \aenv , \akaddr) \\
  \astore' &\triangleq \astore \sqcup [\akaddr' \mapsto \akont]
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%% SET EXPRESSION %%%%%%%%%%%%%%%%%%%%%%%%%
\begin{center}
  $\setsyn{x}{e}$
  $\leadsto \E{e}{\aenv}{\astore'}{\akaddr'}$
\end{center}
\vspace{-7mm}
\begin{align*}
  \text{where }
  \akaddr' &\triangleq \akalloc{\ectrl , \aenv} \\
  \abaddr &\triangleq \aenv(x) \\
  \akont &\triangleq \textbf{setk}(\abaddr , \akaddr) \\
  \astore' &\triangleq \astore \sqcup [\akaddr' \mapsto \akont]
\end{align*}


%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%% COLUMN BREAK %%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%
\vfill\null
\columnbreak
%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%% COLUMN BREAK %%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%% PRIM NO ARG EXPRESSION %%%%%%%%%%%%%%%%%%%%
\begin{center}
  $\singleprimsyn{op}$
  $\leadsto \A{\aval}{\astore}{\akaddr}{}$
\end{center}
\vspace{-7mm}
\begin{align*}
\text{where } \aval &= op \text{ applied to } 0 \text{ arguments}
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%% PRIM WITH ARGS EXPRESSION %%%%%%%%%%%%%%%%
\begin{center}
  $\primsyn{op}{e_0\;e_s}$
  $\leadsto \E{e_0}{\aenv}{\astore'}{\akaddr'}$
\end{center}
\vspace{-7mm}
\begin{align*}
  \text{where }
  \akaddr' &\triangleq \akalloc{\ectrl , \aenv} \\
  \akont &\triangleq \textbf{primk}(op , [\;] , e_s , \aenv , \akaddr) \\
  \astore' &\triangleq \astore \sqcup [\akaddr' \mapsto \akont]
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%% APPLY PRIM EXPRESSION %%%%%%%%%%%%%%%%
\begin{center}
  $\applyprimsyn{op}{e}$
  $\leadsto \E{e}{\aenv}{\astore'}{\akaddr'}$
\end{center}
\vspace{-7mm}
\begin{align*}
  \text{where }
  \akaddr' &\triangleq \akalloc{\ectrl , \aenv} \\
  \akont &\triangleq \textbf{appprimk}(op, \akaddr) \\
  \astore' &\triangleq \astore \sqcup [\akaddr' \mapsto \akont]
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%% APPLY FUNCTION LIST EXPRESSION %%%%%%%%%%%%%%%%
\begin{center}
  $\applysyn{e_f}{e_x}$
  $\leadsto \E{e_f}{\aenv}{\astore'}{\akaddr'}$
\end{center}
\vspace{-7mm}
\begin{align*}
  \text{where }
  \akaddr' &\triangleq \akalloc{\ectrl , \aenv} \\
  \akont &\triangleq \textbf{appappk}(\ectrl,\varnothing , e_x , \aenv , \akaddr) \\
  \astore' &\triangleq \astore \sqcup [\akaddr' \mapsto \akont]
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%% APPLICATION EXPRESSION %%%%%%%%%%%%%%%%
\begin{center}
  $(e_f\;e_s\;...)$
  $\leadsto \E{e_f}{\aenv}{\astore'}{\akaddr'}$
\end{center}
\vspace{-7mm}
\begin{align*}
  \text{where }
  \akaddr' &\triangleq \akalloc{\ectrl , \aenv} \\
  \akont &\triangleq \textbf{appk}(\ectrl , [\;] , e_s , \aenv , \akaddr) \\
  \astore' &\triangleq \astore \sqcup [\akaddr' \mapsto \akont]
\end{align*}
\end{multicols*}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%% ABSTRACT APPLY SEMANTICS %%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%% Page 1 %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage

\begin{multicols*}{2}
[
\begin{center}
\textbf{Apply Rules} \\
Rules for when the control is a value \\
$\hat{\varsigma} = A\langle \aval , \astore , \actrladdr \rangle$ \\
$\actrlkont \in \astore(\actrladdr) $ \\
Proceed by matching on $\actrlkont$ \\
%%%%%%%%%%%%%%%%%%%%%%%%% EMPTY KONT %%%%%%%%%%%%%%%%%%%%%%%%%
\vspace{5mm}
$\textbf{mt} \leadsto \emptyset$
\end{center}
\vspace{-5mm}
]
%%%%%%%%%%%%%%%%%%%%%%%%% IF KONT FALSE %%%%%%%%%%%%%%%%%%%%%%%%%
\begin{center}
  $\textbf{ifk}(\_ , e_f, \aenv_{\akont} , \akaddr)$
  $\leadsto \{\E{e_f}{\aenv_{\akont}}{\astore}{\akaddr}\}$
\end{center}
\vspace{-7mm}
\begin{align*}
\text{where } \aval &= (\falsesyn, \emptyset)
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%% IF KONT TRUE %%%%%%%%%%%%%%%%%%%%%%%%%
\begin{center}
  $\textbf{ifk}(e_t , \_ , \aenv_{\akont} , \akaddr)$
  $\leadsto \{\E{e_t}{\aenv_{\akont}}{\astore}{\akaddr}\}$
\end{center}
\vspace{-7mm}
\begin{align*}
  \text{where } \aval &= (not\;\falsesyn\;nor\;\top , \_)
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%% IF KONT BOTH %%%%%%%%%%%%%%%%%%%%%%%%%
\begin{center}
  $\textbf{ifk}(e_t , e_f , \aenv_{\akont} , \akaddr)$
  $\leadsto \{\E{e_t}{\aenv_{\akont}}{\astore}{\akaddr},
              \E{e_f}{\aenv_{\akont}}{\astore}{\akaddr}\}$
\end{center}
\vspace{-7mm}
\begin{align*}
\text{where } \aval &\in \{(\falsesyn, not\;\emptyset) , (\top, \_)\}
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%% LET KONT DONE %%%%%%%%%%%%%%%%%%%%%%%%%
\begin{center}
  $\textbf{letk}(\ectrl, vars, \adone, [\;], e_b,\aenv_{\akont} , \akaddr)$
  $\leadsto \{\E{e_b}{\aenv_{\akont}'}{\astore'}{\akaddr}\}$
\end{center}
\vspace{-7mm}
\begin{align*}
  \text{where }
  \abaddr_i &\triangleq \aballoc{vars_i , \ectrl} \\
  \aenv_{\akont}' &\triangleq \aenv_{\akont}[vars_0 \mapsto \abaddr_0\;... \\
            &\;\;\;\;\;\;\;\;\;\, vars_{n-1} \mapsto \abaddr_{n-1}] \\
  \adone' &\triangleq \adone \mdoubleplus [\aval] \\
  \astore' &\triangleq \astore \sqcup [\abaddr_0 \mapsto \adone'_0 ... \\
  &\;\;\;\;\;\;\;\;\;\;\;\; \abaddr_{n-1} \mapsto \adone'_{n-1}]
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%% LET KONT MORE TODO %%%%%%%%%%%%%%%%%%%%%%%%%
\begin{center}
  $\textbf{letk}(\ectrl , vars , \adone , e_h::e_t , e_b,\aenv_{\akont} , \akaddr)$
  $\leadsto \{\E{e_h}{\aenv_{\akont}}{\astore'}{\akaddr'}\}$
\end{center}
\vspace{-7mm}
\begin{align*}
  \text{where }
  \akaddr' &\triangleq \akalloc{\ectrl, \aenv_{\akont}} \\
  \akont &\triangleq \textbf{letk}(\ectrl, vars , \adone \mdoubleplus [\aval], \\
  &\;\;\;\;\;\;\;\;\;\;\;\;\;\, e_t , e_b , \aenv_{\akont} , \akaddr) \\
  \astore' &\triangleq \astore \sqcup [\akaddr' \mapsto \akont]
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%% SET! KONT %%%%%%%%%%%%%%%%%%%%%%%%%
\begin{center}
  $\textbf{setk}(\abaddr , \akaddr)$
  $\leadsto \{\A{(\textit{Void} , \emptyset)}{\astore'}{\akaddr}{}\}$
\end{center}
\vspace{-7mm}
\begin{align*}
  \text{where }
  \astore' &\triangleq \astore \sqcup [ \abaddr \mapsto \aval ]
\end{align*}

%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%% COLUMN BREAK %%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%
\vfill\null
\columnbreak
%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%% COLUMN BREAK %%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%%%%%%% CALL/CC MULTIARG KONT %%%%%%%%%%%%%%%%%%%%%
\begin{center}
  $\textbf{callcck}(\ectrl , \akaddr)$
  $\leadsto \{\E{e_b}{\aenv_{\lambda}'}{\astore'}{\akaddr}\}$
\end{center}
\vspace{-7mm}
\begin{align*}
  \text{where }
  \aval &\ni (\_ , (\singlelamsyn{x}{e_b} , \aenv_{\lambda})) \\
  \abaddr &\triangleq \aballoc{x , \ectrl} \\
  \akont &\in \astore(\akaddr) \\
  \aenv_{\lambda}' &\triangleq \aenv_{\lambda}[x \mapsto \abaddr] \\
  \astore' &\triangleq \astore \sqcup [\abaddr \mapsto \akont]
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%% CALL/CC KONT ARG %%%%%%%%%%%%%%%%%%%%%%%%%
\begin{center}
  $\textbf{callcck}(\_, \_)$
  $\leadsto \{\A{\actrlkont}{\astore'}{\actrladdr}{}\}$
\end{center}
\vspace{-7mm}
\begin{align*}
  \text{where }
  \aval &= (\akont , \_) \\
  \astore' &\triangleq \astore \sqcup [\actrladdr \mapsto \akont]
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%% APPLY PRIM KONT %%%%%%%%%%%%%%%%%%%%%%%%%
\begin{center}
  $\textbf{appprimk}(op, \akaddr)$
  $\leadsto \{\A{\aval'}{\astore}{\akaddr}{}\}$
\end{center}
\vspace{-7mm}
\begin{align*}
  \text{where } \aval' &\triangleq op \text{ applied to } \aval
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%% PRIM KONT DONE %%%%%%%%%%%%%%%%%%
\begin{center}
  $\textbf{primk}(op, \adone, [\;], \_, \akaddr)$
  $\leadsto \{\A{\aval'}{\astore}{\akaddr}{}\}$
\end{center}
\vspace{-7mm}
\begin{align*}
  \text{where }\aval'&\triangleq op\text{ applied to }(\adone \mdoubleplus [\aval])
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%% PRIM KONT NOT DONE %%%%%%%%%%%%%%%%%%%%%%%%%
\begin{center}
  $\textbf{primk}(op, \adone , e_h::e_t , \aenv_{\akont} , \akaddr)$
  $\leadsto \{\E{e_h}{\aenv_{\akont}}{\astore'}{\akaddr'}\}$
\end{center}
\vspace{-7mm}
\begin{align*}
  \text{where }
  \akaddr' &\triangleq \akalloc{e_h , \aenv_{\akont}} \\
  \akont &\triangleq \textbf{primk}(op, \adone \mdoubleplus [\aval] \\
            &\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\; e_t , \aenv_{\akont} , \akaddr) \\
  \astore' &\triangleq \astore \sqcup [\akaddr' \mapsto \akont]
\end{align*}
\end{multicols*}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%% ABSTRACT APPLY SEMANTICS %%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%% PAGE 2 %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage

\begin{multicols*}{2}
[
\begin{center}
\textbf{More Apply Rules} \\
Rules for when the control is a value
\end{center}
]
%%%%%%%%%%%%%%%%%%%%%%%%% APPLY LIST DONE MULTIARG %%%%%%%%%%%%%%%%%%%%%%%%%
\begin{center}
  $\textbf{appappk}(\ectrl, \aval_f , \_, \_ , \akaddr)$
  $\leadsto \{\E{e_b}{\aenv_{\lambda}'}{\astore'}{\akaddr}\}$
\end{center}
\vspace{-7mm}
\begin{align*}
  \text{where }
  \aval_f &\ni (\_, (\lamsyn{x_s}{e_b} , \aenv_{\lambda})) \\
  \abaddr_i &\triangleq \aballoc{x_i , \ectrl} \\
  \aenv_{\lambda}' &\triangleq \aenv_{\lambda}[x_0 \mapsto \abaddr_0\;... \\
                        &\;\;\;\;\;\;\;\;\;\,x_{n-1} \mapsto \abaddr_{n-1}] \\
  \astore' &\triangleq \astore \sqcup [\abaddr_0 \mapsto \aval_0\;... \\
                        &\;\;\;\;\;\;\;\;\;\;\;\;\abaddr_{n-1} \mapsto \aval_{n-1}]
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%% APPLY LIST DONE VARARG %%%%%%%%%%%%%%%%%%%%%%%%%
\begin{center}
  $\textbf{appappk}(\ectrl, \aval_f, \_, \_, \akaddr)$
  $\leadsto \{\E{e_b}{\aenv_{\lambda}'}{\astore'}{\akaddr}\}$
\end{center}
\vspace{-7mm}
\begin{align*}
  \text{where }
  \aval_f &\ni (\_, (\vararglamsyn{x}{e_b} , \aenv_{\lambda})) \\
  \abaddr &\triangleq \aballoc{x , \ectrl} \\
  \aenv_{\lambda}' &\triangleq \aenv_{\lambda}[x \mapsto \abaddr] \\
  \astore' &\triangleq \astore \sqcup [\abaddr \mapsto \aval]
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%% APPLY LIST KONT TODO %%%%%%%%%%%%%%%%%
\begin{center}
  $\textbf{appappk}(\ectrl, \varnothing , e_x , \aenv_{\akont} , \akaddr)$
  $\leadsto \{\E{e_x}{\aenv_{\akont}}{\astore'}{\akaddr'}\}$
\end{center}
\vspace{-7mm}
\begin{align*}
  \text{where }
  \akaddr' &\triangleq \akalloc{e_x , \aenv_{\akont}} \\
  \akont &\triangleq \textbf{appappk}(\ectrl,\aval,e_x,\aenv_{\akont},\akaddr) \\
  \astore' &\triangleq \astore \sqcup [\akaddr' \mapsto \akont]
\end{align*}

%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%% COLUMN BREAK %%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%
\vfill\null
\columnbreak
%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%% COLUMN BREAK %%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%%%%%%% APPLICATION MULTIARG %%%%%%%%%%%%%%%%%%%%%%%%%
\begin{center}
  $\textbf{appk}(\ectrl, \aval_h::\aval_t , [\;] , \_ , \akaddr)$
  $\leadsto \{\E{e_b}{\aenv_{\lambda}'}{\astore'}{\akaddr}\}$
\end{center}
\vspace{-7mm}
\begin{align*}
  \text{where }
  \aval_h &\ni (\_ , (\lamsyn{x_s}{e_b} , \aenv_{\lambda})) \\
  \abaddr_i &\triangleq \aballoc{x_i , \ectrl}\\
  \aenv_{\lambda}' &\triangleq \aenv_{\lambda}[x_0 \mapsto \abaddr_0 ... \\
          &\;\;\;\;\;\;\;\;\;\,x_{n-1} \mapsto \abaddr_{n-1}] \\
  \aval_t' &\triangleq \aval_t \mdoubleplus [\aval] \\
  \astore' &\triangleq \astore \sqcup [\abaddr_0 \mapsto \aval_0' ... \\
          &\;\;\;\;\;\;\;\;\;\;\;\;\abaddr_{n-1} \mapsto \aval_{n-1}']
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%% APPLICATION VARARG %%%%%%%%%%%%%%%%%%%%%%%%%
\begin{center}
  $\textbf{appk}(\ectrl, \aval_h::\aval_t , [\;] , \_ , \akaddr)$
  $\leadsto \{\E{e_b}{\aenv_{\lambda}'}{\astore'}{\akaddr}\}$
\end{center}
\vspace{-7mm}
\begin{align*}
  \text{where }
  \aval_h &\ni (\_ , (\vararglamsyn{x}{e_b} , \aenv_{\lambda})) \\
  \abaddr &\triangleq \aballoc{x , \ectrl} \\
  \aenv_{\lambda}' &\triangleq \aenv_{\lambda}[x \mapsto \abaddr] \\
  \aval_t' &\triangleq \aval_t \mdoubleplus [\aval] \\
  \astore' &\triangleq \astore \sqcup [\abaddr \mapsto \aval_t']
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%% APPLICATION KONTINUATION %%%%%%%%%%%%%%%%%%%%%
\begin{center}
  $\textbf{appk}(\ectrl , [\aval_f] , [\;] . \aenv_{\akont} , \_)$
  $\leadsto \{\A{\aval}{\astore'}{\akaddr}{}\}$
\end{center}
\vspace{-7mm}
\begin{align*}
  \text{where }
  \aval_f &= (\akont_{\lambda} , \_) \\
  \akaddr &\triangleq \akalloc{\ectrl , \aenv_{\akont}} \\
  \astore' &\triangleq \astore \sqcup [\akaddr \mapsto \akont_{\lambda}]
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%% APPLICATION NOT DONE %%%%%%%%%%%%%%%%%%%%%%%%%
\begin{center}
  $\textbf{appk}(\ectrl , \adone , e_h::e_t , \aenv_{\akont} , \akaddr)$
  $\leadsto \{\E{e_h}{\aenv_{\akont}}{\astore'}{\akaddr'}\}$
\end{center}
\vspace{-7mm}
\begin{align*}
  \text{where }
  \akaddr' &\triangleq \akalloc{e_h , \aenv_{\akont}} \\
  \akont &\triangleq \textbf{appk}(\ectrl, \adone \mdoubleplus [\aval],
            e_t , \aenv_{\akont} , \akaddr) \\
  \astore' &\triangleq \astore \sqcup [\akaddr' \mapsto \akont]
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%% ITS OVER %%%%%%%%%%%%%%%%%%%%%%%%%
\end{multicols*}
\end{document}
