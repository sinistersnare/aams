\title{CESK* / CFA Formalism}
\author{
	Davis Silverman
}
\date{}

\documentclass[12pt,draft]{article}

\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{tikz}
\usepackage{titling}
\usepackage{multicol}

\setlength{\columnsep}{0cm} % Column separation from multicol
%\setlength{\droptitle}{-10cm}  % Make title not in middle of page (uses titling package)
\def\checkmark{\tikz\fill[scale=0.4](0,.35) -- (.25,0) -- (1,.7) -- (.25,.15) -- cycle;}

% \setcounter{section}{-1} % sets the first section number to 0
\newcommand\mdoubleplus{\ensuremath{\mathbin{+\mkern-9mu+}}}
\newcommand\mae{\ensuremath{\text{\ae}}}
\newcommand{\lamsyn}[2]{(\lambda\;(#1 ...)\;#2)}
\newcommand{\singlelamsyn}[2]{(\lambda\;(#1)\;#2)}
\newcommand{\vararglamsyn}[2]{(\lambda\;#1\;#2)}
\newcommand{\letsyn}[3]{(\texttt{let}\;([#1\;#2]\;...)\;#3)}
\newcommand{\ifsyn}[3]{(\texttt{if}\;#1\;#2\;#3)}
\newcommand{\primsyn}[2]{(\texttt{prim}\;#1\;#2\;...)}
\newcommand{\singleprimsyn}[1]{(\texttt{prim}\;#1)}
\newcommand{\applyprimsyn}[2]{(\texttt{apply-prim}\;#1\;#2)}
\newcommand{\applysyn}[2]{(\texttt{apply}\;#1\;#2)}
\newcommand{\callccsyn}[1]{(\texttt{call/cc}\;#1)}
\newcommand{\setsyn}[2]{(\texttt{set!}\;#1\;#2)}
\newcommand{\quotesyn}[1]{(\texttt{quote}\;#1)}

\newcommand{\truesyn}{\texttt{\#t}}
\newcommand{\falsesyn}{\texttt{\#f}}


\newcommand{\ctrl}[0]{e_{\varsigma}}
\newcommand{\env}[0]{\rho}
\newcommand{\store}[0]{\sigma}
\newcommand{\baddr}[0]{a}
\newcommand{\kaddr}[0]{a_{\kappa}}
\newcommand{\kont}[0]{\kappa}
\newcommand{\state}[0]{\varsigma}
\newcommand{\E}[4]{E\langle #1 , #2 , #3 , #4 \rangle}
\newcommand{\A}[3]{A\langle #1 , #2 , #3 \rangle}

\begin{document}
% \maketitle


% textsf for syntactic domains
% textit for semantic domains
% \maketitle
\section{Concrete Semantics of Scheme}

{\footnotesize
\begin{multicols*}{2}
\begin{center}
\textbf{Syntax Domains:}
\end{center}
\vspace{-16mm}
\begin{center}
\begin{align*}
%%%%%%%%%%%%%%%%%%%%%%%%% EXPRESSIONS %%%%%%%%%%%%%%%%%%%%%%%%%
  e \in \textsf{Exp} &::= \mae \\
                     &|\; \ifsyn{e}{e}{e} \\
                     &|\; \letsyn{x}{e}{e} \\
                     &|\; \callccsyn{e} \\
                     &|\; \setsyn{x}{e} \\
                     &|\; \primsyn{op}{e} \\
                     &|\; \applyprimsyn{op}{e} \\
                     &|\; \applysyn{e}{e} \\
                     &|\; (e\;e\;...) \\
%%%%%%%%%%%%%%%%%%%%%%%%% ATOMIC EXPRESSIONS %%%%%%%%%%%%%%%%%%%%%%%%%
  \mae \in \textsf{AExp} &::= x\;|\; lam\;|\; \mathbb{Z}
                           \;|\; \truesyn \;|\; \falsesyn \\
                   &\;\;\;\;\;\;\;\;\;\, |\; \quotesyn{e} \\
%%%%%%%%%%%%%%%%%%%%%%%%% LAMBDA EXPRESSIONS %%%%%%%%%%%%%%%%%%%%%%%%%
  lam \in \textsf{Lam} &::= \lamsyn{x}{e} \;|\; \vararglamsyn{x}{e} \\
%%%%%%%%%%%%%%%%%%%%%%%%% VARIABLE SET %%%%%%%%%%%%%%%%%%%%%%%%%
  x \in \textsf{Var} &\;\;\;\;\;\; \text{A set of identifiers} \\
%%%%%%%%%%%%%%%%%%%%%%%%% PRIMITIVE SET %%%%%%%%%%%%%%%%%%%%%%%%%
  op \in \textsf{Prim} &\;\;\;\;\;\; \text{A set of primitives} \\
%%%%%%%%%%%%%%%%%%%%%%%%% END SYNTAX DOMAINS %%%%%%%%%%%%%%%%%%%%%%%%%
\end{align*}
\end{center}
%%%%%%%%%%%%%%%%%%%%% OTHER THINGS COLUMN 1! %%%%%%%%%%%%%%%%%%
\vspace{-7mm}
%%%%%%%%%%%%%%%%%%%%%%%%% ATOMIC EVALUATION %%%%%%%%%%%%%%%%%%%%%%%%%
\begin{center}
  \textbf{Atomic Evaluation:} \\
  $\mathcal{A} : \Sigma_E \rightharpoonup \textit{Val}$
\vspace{-7mm}
\end{center}
\begin{align*}
  \mathcal{A}(\langle lam , \rho , ... \rangle)  &\triangleq (lam , \rho) \\
  \mathcal{A}(\langle \quotesyn{e} , ... \rangle) &\triangleq \textbf{quote}(e) \\
  \mathcal{A}(\langle x, \rho , \sigma , ... \rangle) &\triangleq \sigma(\rho(x)) \\
  \mathcal{A}(\langle \mae , ... \rangle) &\triangleq \mae
\end{align*}
\vspace{-9mm}
%%%%%%%%%%%%%%%%%%%%%%%%% INJECTION %%%%%%%%%%%%%%%%%%%%%%%%%
\begin{center}
\textbf{Injection:} \\
$\mathcal{I} : \textsf{Exp} \rightarrow \Sigma_E$ \\
$\mathcal{I}(e) \triangleq E\langle e , \varnothing , \varnothing , \{(0, 0) : \textbf{mt}\} , (0, 0) \rangle$
\end{center}
\vspace{-8mm}
%%%%%%%%%%%%%%%%%%%%%%%%% STORE JOIN SEMANTICS %%%%%%%%%%%%%%%%%%%%%%%%%
\begin{center}
  \textbf{Store Joining:} \\
  $\store \sqcup [a \mapsto v] \triangleq \store[a \mapsto v]$ \\
\end{center}
%%%%%%%%%%%%%%%%%%%%%%%%% COLLECTING SEMANTICS %%%%%%%%%%%%%%%%%%%%%%%%%
\begin{center}
  \textbf{Collecting Semantics:} \\
  $eval(e) = \{\varsigma \;|\; \mathcal{I}(e) \mapsto\hspace{-1.5mm}^*\; \varsigma \}$
\end{center}
\vspace{-10mm}


%%%%% COLUMN BREAK %%%%%%
\vfill\null
\columnbreak
%%%%% COLUMN BREAK %%%%%%


\begin{center}
\textbf{Semantic Domains:}
\end{center}
\vspace{-8mm}
\begin{align*}
%%%%%%%%%%%%%%%%%%%%%%%%% STATES %%%%%%%%%%%%%%%%%%%%%%%%%
\varsigma \in \Sigma &\triangleq E\langle\textit{Eval}\rangle
								+ A\langle\textit{Apply}\rangle \\
  \textit{Eval} &\triangleq \textsf{Exp} \times \textit{Env}
                  \times \textit{Store} \times \textit{Addr} \\
  \textit{Apply} &\triangleq \textit{Val} \times \textit{Store}
                   \times \textit{Addr} \\
%%%%%%%%%%%%%%%%%%%%%%%%% ENVIRONMENT %%%%%%%%%%%%%%%%%%%%%%%%%
  \rho \in \textit{Env} &\triangleq \textsf{Var} \rightharpoonup
	  											\textit{Addr} \\
%%%%%%%%%%%%%%%%%%%%%%%%% STORE %%%%%%%%%%%%%%%%%%%%%%%%%
  \sigma \in \textit{Store} &\triangleq \textit{BAddr} \rightharpoonup
                              \textit{Val} \\
  & \times \textit{KAddr} \rightharpoonup \textit{Kont} \\
%%%%%%%%%%%%%%%%%%%%%%%%% VALUES %%%%%%%%%%%%%%%%%%%%%%%%%
  v \in \textit{Val} &\triangleq \textit{Clo} + \textit{Kont} + \mathbb{Z} \\
                     &+ \{ \truesyn,\falsesyn, \textit{Null} , \textit{Void} \} \\
                     &+ \{\textbf{quote}(e) , \textbf{cons}(v, v)\} \\
%%%%%%%%%%%%%%%%%%%%%%%%% CLOSURES %%%%%%%%%%%%%%%%%%%%%%%%%
  clo \in \textit{Clo} &\triangleq \textsf{Lam} \times \textit{Env} \\
  %%%%%%%%%%%%%%%%%%%%%%%%% ADDRESSES %%%%%%%%%%%%%%%%%%%%%%%%%
  a \in \textit{BAddr} &\triangleq \mathbb{N} \times \mathbb{N} \\
  a_\kappa \in \textit{KAddr} &\triangleq \mathbb{N} \\
%%%%%%%%%%%%%%%%%%%%%%%%% KONTINUATIONS %%%%%%%%%%%%%%%%%%%%%%%%%
  \kappa \in \textit{Kont} &::= \textbf{mt} \\
                     &|\; \textbf{ifk}(e, e, \env, \kaddr) \\
                     &|\; \textbf{letk}(vars, done, todo, e, \env , \kaddr) \\
                     &|\; \textbf{callcck}(\kaddr) \\
                     &|\; \textbf{setk}(x, \env, \kaddr) \\
                     &|\; \textbf{primk}(op, done, todo, \env, \kaddr) \\
                     &|\; \textbf{appprimk}(op, \kaddr) \\
                     &|\; \textbf{appk}(done, todo, \env , \kaddr) \\
                     &|\; \textbf{appappk}(val?, e, \env , \kaddr) \\
%%%%%%%%%%%%%%%%%%%%%%%%% OTHER VARIABLES %%%%%%%%%%%%%%%%%%%%%%%%%
%%% done/todo variables
  done &\triangleq \textit{Val}^\ast \\
  todo &\triangleq \textsf{Exp}^* \\
  vars &\triangleq \textsf{Var}^*
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%% ALLOC FUNCTION %%%%%%%%%%%%%%%%
\begin{center}
  \textbf{Address Allocation:} \\
  $\;\;\;\;\;\;\;balloc : \Sigma \times \mathbb{N} \rightarrow \textit{BAddr}$ \\
  $kalloc : \Sigma \rightarrow \textit{KAddr}$
\end{center}
\vspace{-6mm}
\begin{align*}
  balloc(\langle \sigma , ... \rangle, n) &\triangleq (|\sigma| , n) \\
  kalloc(\langle \sigma , ... \rangle) &\triangleq (|\sigma|)
\end{align*}
\end{multicols*}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%% BEGIN EVAL SEMANTICS %%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage

\footnotesize{
\begin{multicols*}{2}
[
\begin{center}
\textbf{Eval Rules} \\
Rules for when the control is an expression \\
\vspace{2mm}
$\state = \E{\ctrl}{\env}{\store}{\kaddr}$
Proceed by matching on $\ctrl$ \\
%%%%%%%%%%%%%%%%%%%%%%%%% ATOMIC EVALUATION %%%%%%%%%%%%%%%%
\vspace{3mm}
$\mae \leadsto \A{v}{\store}{\kaddr}$
\end{center}
]
%%%%%%%%%%%%%%%%%%%%%%%%% IF EXPRESSION %%%%%%%%%%%%%%%%%%%%%%%%%
\begin{center}
  $\ifsyn{e_c}{e_t}{e_f}$
  $\leadsto \E{e_c}{\env}{\store'}{\kaddr'}$
\end{center}
\vspace{-7mm}
\begin{align*}
  \text{where }
  \kaddr' &\triangleq kalloc(\state) \\
  \kont &\triangleq \textbf{ifk}(e_t , e_f , \env , \kaddr) \\
  \store' &\triangleq \store \sqcup [\kaddr' \mapsto \kont]
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%% LET EXPRESSION NO ARGSVALS %%%%%%%%%%%%%%%%%%%
\begin{center}
  $(\texttt{let}\;()\;e_b)$
  $\leadsto \E{e_b}{\env}{\store}{\kaddr}$
\end{center}
\vspace{-5mm}
%%%%%%%%%%%%%%%%%%%%%%%%% LET EXPRESSION VALS GOT ARGS %%%%%%%%%%%%%%%
\begin{center}
  $(\texttt{let}\;binds\;e_b)$
  $\leadsto \E{e_0}{\env}{\store'}{\kaddr'}$
\end{center}
\vspace{-7mm}
\begin{align*}
  \text{where }
  binds &= ([x_0\;e_0]\;[x_s\;e_s]\;...) \\
  \kaddr' &\triangleq kalloc(\state) \\
  \kont &\triangleq \textbf{letk}(x_0::x_s , [\;] , e_s , e_b , \env , \kaddr) \\
  \store' &\triangleq \store \sqcup [\kaddr' \mapsto \kont]
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%% CALL/CC EXPRESSION %%%%%%%%%%%%%%%%%%%%%%%%%
\begin{center}
  $\callccsyn{e}$
  $\leadsto \E{e}{\env}{\store'}{\kaddr'}$
\end{center}
\vspace{-5mm}
\begin{align*}
  \text{where }
  \kaddr' &\triangleq kalloc(\state) \\
  \kont &\triangleq \textbf{callcck}(\kaddr) \\
  \store' &\triangleq \store \sqcup [\kaddr \mapsto \kont]
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%% SET EXPRESSION %%%%%%%%%%%%%%%%%%%%%%%%%
\begin{center}
  $\setsyn{x}{e}$
  $\leadsto \E{e}{\env}{\store'}{\kaddr'}$
\end{center}
\vspace{-5mm}
\begin{align*}
  \text{where }
  \kaddr' &\triangleq kalloc(\state) \\
  \baddr &\triangleq \env(x) \\
  \kont &\triangleq \textbf{setk}(\baddr , \kaddr) \\
  \store' &\triangleq \store \sqcup [\kaddr' \mapsto \kont]
\end{align*}


%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%% COLUMN BREAK %%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%
\vfill\null
\columnbreak
%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%% COLUMN BREAK %%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%% PRIM NO ARG EXPRESSION %%%%%%%%%%%%%%%%%%%%
\begin{center}
  $\singleprimsyn{op}$
  $\leadsto \A{v}{\store}{\kaddr}$
\end{center}
\vspace{-7mm}
\begin{align*}
\text{where } v &= op \text{ applied to } 0 \text{ arguments}
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%% PRIM WITH ARGS EXPRESSION %%%%%%%%%%%%%%%%
\begin{center}
  $\primsyn{op}{e_0\;e_s}$
  $\leadsto \E{e_0}{\env}{\store'}{\kaddr'}$
\end{center}
\vspace{-7mm}
\begin{align*}
  \text{where }
  \kaddr' &\triangleq kalloc(\state) \\
  \kont &\triangleq \textbf{primk}(op , [\;], e_s , \env , \kaddr) \\
  \store' &\triangleq \store \sqcup [\kaddr' \mapsto \kont]
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%% APPLY PRIM EXPRESSION %%%%%%%%%%%%%%%%
\begin{center}
  $\applyprimsyn{op}{e}$
  $\leadsto \E{e}{\env}{\store'}{\kaddr'}$
\end{center}
\vspace{-7mm}
\begin{align*}
  \text{where }
  \kaddr' &\triangleq kalloc(\state) \\
  \kont &\triangleq \textbf{appprimk}(op, \kaddr) \\
  \store' &\triangleq \store \sqcup [\kaddr' \mapsto \kont]
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%% APPLY FUNCTION LIST EXPRESSION %%%%%%%%%%%%%%%%
\begin{center}
  $\applysyn{e_f}{e_x}$
  $\leadsto \E{e_f}{\env}{\store'}{\kaddr'}$
\end{center}
\vspace{-7mm}
\begin{align*}
  \text{where }
  \kaddr' &\triangleq kalloc(\state) \\
  \kont &\triangleq \textbf{appappk}(\varnothing, e_x, \env, \kaddr) \\
  \store' &\triangleq \store \sqcup [\kaddr' \mapsto \kont]
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%% APPLICATION EXPRESSION %%%%%%%%%%%%%%%%
\begin{center}
  $(e_f\;e_s\;...)$
  $\leadsto \E{e_f}{\env}{\store'}{\kaddr'}$
\end{center}
\vspace{-5mm}
\begin{align*}
  \text{where }
  \kaddr' &\triangleq kalloc(\state) \\
  \kont &\triangleq \textbf{appk}([\;] , e_s , \env , \kaddr) \\
  \store' &\triangleq \store \sqcup [\kaddr' \mapsto \kont]
\end{align*}
\end{multicols*}
} % footnotesize


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%% BEGIN APPLY SEMANTICS %%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% PAGE 1 %%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage

\newcommand{\kenv}[0]{\env_{\kappa}}
\newcommand{\lamenv}[0]{\env_{\lambda}}

\begin{multicols*}{2}
[
\begin{center}
\textbf{Apply Rules} \\
Rules for when the control is a value \\
$\state = \A{v}{\store}{\kaddr}$ \\
$\kont \triangleq \store(\kaddr)$ \\
Proceed by matching on $\kont$ \\
%%%%%%%%%%%%%%%%%%%%%%%%% EMPTY KONT %%%%%%%%%%%%%%%%%%%%%%%%%
\vspace{5mm}
$\textbf{mt} \leadsto \state$
\end{center}
\vspace{-5mm}
]
%%%%%%%%%%%%%%%%%%%%%%%%% IF KONT FALSE %%%%%%%%%%%%%%%%%%%%%%%%%
\begin{center}
  $\textbf{ifk}(\_ , e_f , \kenv , \kaddr')$
  $\leadsto \E{e_f}{\kenv}{\store}{\kaddr'}$
\end{center}
\vspace{-7mm}
\begin{align*}
\text{where } v &= \falsesyn
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%% IF KONT TRUE %%%%%%%%%%%%%%%%%%%%%%%%%
\begin{center}
  $\textbf{ifk}(e_t , \_ , \kenv, \kaddr')$
  $\leadsto \E{e_t}{\kenv}{\store}{\kaddr'}$
\end{center}
\vspace{-7mm}
\begin{align*}
\text{where } v &\not= \falsesyn
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%% LET KONT DONE %%%%%%%%%%%%%%%%%%%%%%%%%
\begin{center}
  $\textbf{letk}(vars , done , [\;] , e_b , \kenv , \kaddr')$
  $\leadsto \E{e_b}{\kenv'}{\store'}{\kaddr'}$
\end{center}
\vspace{-7mm}
\begin{align*}
  \text{where }
  \baddr_i &\triangleq balloc(\state , i) \\
  done' &\triangleq done \mdoubleplus [v] \\
  \kenv' &\triangleq \kenv[vars_0 \mapsto a_0\;...\\
           &\;\;\;\;\;\;\;\;\;\; vars_{n-1} \mapsto a_{n-1}] \\
  \store' &\triangleq \sigma \sqcup [a_0 \mapsto done'_0\;...\\
           &\;\;\;\;\;\;\;\;\;\;\;\; a_{n-1} \mapsto done'_{n-1}]
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%% LET KONT MORE TODO %%%%%%%%%%%%%%%%%%%%%%%%%
\begin{center}
  $\textbf{letk}(vars, done, e_h::e_t , e_b , \kenv , \kaddr')$
  $\leadsto \E{e_h}{\kenv}{\store'}{\kaddr''}$
\end{center}
\vspace{-7mm}
\begin{align*}
  \text{where }
  \kaddr'' &\triangleq kalloc(\state) \\
  \kont' &\triangleq \textbf{letk}(vars, done \mdoubleplus [v], \\
           &\;\;\;\;\;\;\;\;\;\;\;\;\;e_t , e_b , \kenv , \kaddr') \\
  \store' &\triangleq \store \sqcup [\kaddr'' \mapsto \kont']
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%% SET! KONT %%%%%%%%%%%%%%%%%%%%%%%%%
\begin{center}
  $\textbf{setk}(\baddr, \kaddr')$
  $\leadsto \A{\textit{Void}}{\store'}{\kaddr'}$
\end{center}
\vspace{-7mm}
\begin{align*}
  \text{where } \store' &\triangleq \store \sqcup [a \mapsto v]
\end{align*}

%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%% COLUMN BREAK %%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%
\vfill\null
\columnbreak
%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%% COLUMN BREAK %%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%%%%%%% CALL/CC MULTIARG KONT %%%%%%%%%%%%%%%%%%%%%
\begin{center}
  $\textbf{callcck}(\kaddr')$
  $\leadsto \E{e}{\lamenv'}{\store'}{\kaddr'}$
\end{center}
\vspace{-7mm}
\begin{align*}
  \text{where }
  v &= (\singlelamsyn{x}{e} , \lamenv) \\
  \baddr &\triangleq balloc(\state, 0) \\
  \kont' &\triangleq \store(\kaddr') \\
  \lamenv' &\triangleq \lamenv[x \mapsto \baddr] \\
  \store' &\triangleq \store \sqcup [\baddr \mapsto \kont']
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%% CALL/CC KONT ARG %%%%%%%%%%%%%%%%%%%%%%%%%
\begin{center}
  $\textbf{callcck}(\_)$
  $\leadsto \A{\kont}{\store'}{\kaddr'}$
\end{center}
\vspace{-7mm}
\begin{align*}
  \text{where }
  v &= \kont' \\
  \kaddr' &\triangleq kalloc(\state) \\
  \store' &\triangleq \store \sqcup [\kaddr' \mapsto \kont']
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%% APPLY PRIM KONT %%%%%%%%%%%%%%%%%%%%%%%%%
\begin{center}
  $\textbf{appprimk}(op, \kaddr')$
  $\leadsto \A{v'}{\store}{\kaddr'}$
\end{center}
\vspace{-7mm}
\begin{align*}
\text{where } v' &\triangleq op \text{ applied to } v
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%% PRIM KONT DONE %%%%%%%%%%%%%%%%%%
\begin{center}
  $\textbf{primk}(op , done , [\;] , \_ , \kaddr')$
  $\leadsto \A{v'}{\store}{\kaddr'}$
\end{center}
\vspace{-7mm}
\begin{align*}
\text{where } v' &\triangleq op \text{ applied to } (done \mdoubleplus [v])
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%% PRIM KONT NOT DONE %%%%%%%%%%%%%%%%%%%%%%%%%
\begin{center}
  $\textbf{primk}(op, done, e_h::e_t, \kenv, \kaddr')$
  $\leadsto \E{e_h}{\kenv}{\store'}{\kaddr''}$
\end{center}
\vspace{-7mm}
\begin{align*}
  \text{where }
  \kaddr'' &\triangleq kalloc(\state) \\
  \kont' &\triangleq \textbf{primk}(op, done \mdoubleplus [v],\\
           &\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\; e_t , \kenv , \kaddr') \\
  \store' &\triangleq \store \sqcup [\kaddr'' \mapsto \kont']
\end{align*}
\end{multicols*}
\newpage

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%% MORE APPLY SEMANTICS %%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% PAGE 2 %%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{multicols*}{2}
[
\begin{center}
\textbf{More Apply Rules} \\
Rules for when the control is a value
\end{center}
]
%%%%%%%%%%%%%%%%%%%%%%%%% APPLY LIST DONE MULTIARG %%%%%%%%%%%%%%%%%%%%%%%%%
\begin{center}
  $\textbf{appappk}(v_f , \_ , \_ , \kaddr')$
  $\leadsto \E{e_b}{\lamenv'}{\store'}{\kaddr'}$
\end{center}
\vspace{-7mm}
\begin{align*}
  \text{where }
  v_f &= (\lamsyn{x_s}{e_b} , \lamenv) \\
  a_i &\triangleq balloc(\state, i) \\
  \lamenv' &\triangleq \lamenv[x_0 \mapsto a_0\;...\\
      &\;\;\;\;\;\;\;\;\;\,x_{n-1} \mapsto a_{n-1}] \\
  \store' &\triangleq \store \sqcup [a_0 \mapsto v_0\;...\\
  &\;\;\;\;\;\;\;\;\;\;\;\;a_{n-1} \mapsto v_{n-1}]
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%% APPLY LIST DONE VARARG %%%%%%%%%%%%%%%%%%%%%%%%%
\begin{center}
  $\textbf{appappk}(v_f, \_, \_, \kaddr')$
  $\leadsto \E{e_b}{\lamenv'}{\store'}{\kaddr'}$
\end{center}
\vspace{-7mm}
\begin{align*}
  \text{where }
  v_f &= (\vararglamsyn{x}{e_b}, \lamenv) \\
  a &\triangleq balloc(\state, 0) \\
  \lamenv' &\triangleq \lamenv[x \mapsto a] \\
  \store' &\triangleq \store \sqcup [a \mapsto v]
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%% APPLY LIST KONT TODO %%%%%%%%%%%%%%%%%
\begin{center}
  $\textbf{appappk}(\varnothing, e, \kenv, \kaddr')$
  $\leadsto \E{e}{\kenv}{\store'}{\kaddr''}$
\end{center}
\vspace{-7mm}
\begin{align*}
  \text{where }
  \kaddr'' &\triangleq kalloc(\state) \\
  \kont' &\triangleq \textbf{appappk}(v, e, \kenv , \kaddr') \\
  \store' &\triangleq \store \sqcup [\kaddr'' \mapsto \kont']
\end{align*}

%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%% COLUMN BREAK %%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%
\vfill\null
\columnbreak
%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%% COLUMN BREAK %%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%%%%%%% APPLICATION MULTIARG %%%%%%%%%%%%%%%%%%%%%%%%%
\begin{center}
  $\textbf{appk}(done, [\;] , \_ , \kaddr')$
  $\leadsto \E{e_b}{\lamenv'}{\store'}{\kaddr'}$
\end{center}
\vspace{-7mm}
\begin{align*}
  \text{where }
  done &= (\lamsyn{x_s}{e_b} , \lamenv) :: v_s \\
  a_i &\triangleq balloc(\state, i) \\
  v'_s &\triangleq v_s \mdoubleplus [v] \\
  \lamenv' &\triangleq \lamenv[x_0 \mapsto a_0\;...\\
       &\;\;\;\;\;\;\;\;\;\;x_{n-1} \mapsto a_{n-1}] \\
  \store' &\triangleq \store \sqcup [a_0 \mapsto v'_0\;...\\
  &\;\;\;\;\;\;\;\;\;\;\;\; a_{n-1} \mapsto v'_{n-1}]
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%% APPLICATION VARARG %%%%%%%%%%%%%%%%%%%%%%%%%
\begin{center}
  $\textbf{appk}(done, [\;], \_, \kaddr')$
  $\leadsto \E{e_b}{\lamenv'}{\store'}{\kaddr'}$
\end{center}
\vspace{-7mm}
\begin{align*}
  \text{where }
  done &= (\vararglamsyn{x}{e_b} , \lamenv) :: v_s \\
  a &\triangleq balloc(\state, 0) \\
  v'_s &\triangleq v_s \mdoubleplus [v] \\
  \lamenv' &\triangleq \lamenv[x \mapsto a] \\
  \store' &\triangleq \store \sqcup [a \mapsto v'_s]
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%% APPLICATION KONTINUATION %%%%%%%%%%%%%%%%%%%%%
\begin{center}
  $\textbf{appk}([\kont_\lambda] , [\;] , \kenv , \kaddr')$
  $\leadsto \A{v}{\store'}{\kaddr''}$
\end{center}
\vspace{-6mm}
\begin{align*}
  \text{where }
  \kaddr'' &\triangleq kalloc(\state) \\
  \store' &\triangleq \store \sqcup [\kaddr'' \mapsto \kont_\lambda]
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%% APPLICATION TODO %%%%%%%%%%%%%%%%%%%%%%%%%
\begin{center}
  $\textbf{appk}(done , e_h::e_t , \kenv , \kaddr')$
  $\leadsto \E{e_h}{\kenv}{\store'}{\kaddr''}$
\end{center}
\vspace{-7mm}
\begin{align*}
  \text{where }
  \kaddr'' &\triangleq kalloc(\state) \\
  \kont' &\triangleq \textbf{appk}(done \mdoubleplus [v] , e_t , \kenv , \kaddr') \\
  \store' &\triangleq \store \sqcup [\kaddr'' \mapsto \kont']
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%% ITS OVER %%%%%%%%%%%%%%%%%%%%%%%%%
\end{multicols*}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%% ABSTRACT SEMANTICS %%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newcommand{\aenv}[0]{\hat{\rho}}
\newcommand{\astore}[0]{\hat{\sigma}}
\newcommand{\aval}[0]{\hat{v}}
\newcommand{\aclo}[0]{\widehat{clo}}
\newcommand{\abaddr}[0]{\hat{a}}
\newcommand{\akaddr}[0]{\hat{a}_{\hat{\kappa}}}
\newcommand{\aballoc}[1]{\widehat{balloc}(#1)}
\newcommand{\akalloc}[1]{\widehat{kalloc}(#1)}
\newcommand{\akont}[0]{\hat{\kappa}}
\newcommand{\ectrl}[0]{e_{\hat{\varsigma}}}
\newcommand{\adone}[0]{\widehat{done}}
\newcommand{\actrladdr}[0]{\hat{a}_{\kappa\varsigma}}
\newcommand{\actrlkont}[0]{\kappa_{\varsigma}}

\newpage
\section{Abstract Semantics of Scheme}

\begin{multicols*}{2}
  [
  \begin{center}
    \textbf{Abstract Semantic Domains:}
  \end{center}
  \vspace{-15mm}
  ]
  \begin{align*}
    \vspace{-10mm}
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% ABSTRACT STATE %%%%%%%%%%%%%%%%%%%%%%%
    \hat{\varsigma} \in \hat{\Sigma}
    &\triangleq E\langle \textit{Eval} \rangle + E\langle \textit{Apply} \rangle\\
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% ABSTRACT EVAL STATE %%%%%%%%%%%%%%%%%%
    Eval &\triangleq \textsf{Exp}
           \times \widehat{\textit{Env}}
           \times \widehat{\textit{Store}}
           \times \widehat{\textit{KAddr}} \\
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% ABSTRACT APPLY STATE %%%%%%%%%%%%%%%%%
    Apply &\triangleq \widehat{\textit{Val}}
            \times \widehat{\textit{Store}} \times \widehat{\textit{KAddr}} \\
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% ABSTRACT ENV %%%%%%%%%%%%%%%%%%%%%%%%%
    \aenv \in \widehat{\textit{Env}}
    &\triangleq \textsf{Var} \rightharpoonup \widehat{\textit{Addr}} \\
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% ABSTRACT STORE %%%%%%%%%%%%%%%%%%%%%%%%%
    \astore \in \widehat{\textit{Store}}
    &\triangleq \widehat{\textit{BAddr}} \rightharpoonup \widehat{\textit{Val}} \\
    &\times \widehat{KAddr} \rightharpoonup \mathcal{P}(\widehat{\textit{Kont}}) \\
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% ABSTRACT VALUE %%%%%%%%%%%%%%%%%%%%%%%%%
    \aval \in \widehat{\textit{Val}} &\triangleq
                                       (\widehat{\textit{CVal}} + \top + \bot)
                                       \times \mathcal{P}(\widehat{\textit{Clo}}) \\
    \hat{cv} \in \widehat{\textit{CVal}}
    &\triangleq \widehat{\textit{Kont}} + \mathbb{Z} \\
    &+ \{\truesyn , \falsesyn , \textit{Null} , \textit{Void}\} \\
    &+ \{\textbf{quote}(e) , \textbf{cons}(\aval, \aval)\} \\
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% ABSTRACT CLO %%%%%%%%%%%%%%%%%%%%%%%%%%%
    \aclo \in \widehat{\textit{Clo}}
    &\triangleq \textsf{Lam} \times \widehat{\textit{Env}} \\
    %%%%%%%%%%%%%%%%%%%%%%%%% ABSTRACT ADDRESSES %%%%%%%%%%%%%%%%%%%%%%%%%
    \abaddr \in \widehat{\textit{BAddr}}
    &\triangleq
      \textsf{Var} \times \textsf{Expr} \\
    \akaddr \in \widehat{\textit{KAddr}}
    &\triangleq
      \textsf{Expr} \times \widehat{\textit{Env}} \\
    %%%%%%%%%%%%%%%%%%%%%%%%% OTHER ABSTRACT VARIABLES %%%%%%%%%%%%%%%%%%%%%%%%%
    \adone &\triangleq \widehat{\textit{Val}}^*
                     \end{align*}
  \begin{center}
    \textbf{Abstract Atomic Evaluation:} \\
    $\mathcal{A} : \textit{Eval} \rightarrow \widehat{\textit{Val}}$
  \end{center}
  \vspace{-7mm}
  \begin{align*}
    \mathcal{A}(E\langle lam , \aenv , ... \rangle)
    &\triangleq (\bot , \{(lam , \aenv)\}) \\
    \mathcal{A}(\mae)
    &\triangleq (\mae , \emptyset) \\
  \end{align*}
  %%%%%%%%%%%%%%%%%%%%%%%%%
  %%%%% COLUMN BREAK %%%%%%
  %%%%%%%%%%%%%%%%%%%%%%%%%
  \vfill\null
  \columnbreak
  %%%%%%%%%%%%%%%%%%%%%%%%%
  %%%%% COLUMN BREAK %%%%%%
  %%%%%%%%%%%%%%%%%%%%%%%%%
  \begin{align*}
    %%%%%%%%%%%%%%%%%%%%%%%%% ABSTRACT KONTINUATIONS %%%%%%%%%%%%%%%%%%%%%%%%%
    \hat{\kappa} \in \widehat{\textit{Kont}}
    &::= \textbf{mt} \\
    &|\; \textbf{ifk}(e, e, \aenv, \akaddr) \\
    &|\; \textbf{letk}(e, vars, \adone, todo, e , \aenv, \akaddr) \\
    &|\; \textbf{callcck}(e, \akaddr) \\
    &|\; \textbf{setk}(\abaddr, \akaddr) \\
    &|\; \textbf{primk}(op, \adone, todo, \aenv, \akaddr) \\
    &|\; \textbf{appprimk}(op, \akaddr) \\
    &|\; \textbf{appk}(e, \adone, todo, \aenv, \akaddr) \\
    &|\; \textbf{appappk}(e, \aval?, e, \aenv, \akaddr) \\
  \end{align*}
  \begin{center}
    \textbf{Allocation:}
  \end{center}
  \vspace{-7mm}
  \begin{align*}
    \widehat{balloc}:\textsf{Var} \times \textsf{Expr} &\rightarrow \widehat{\textit{BAddr}} \\
    \widehat{balloc}(x, e) &\triangleq (x, e) \\
    \widehat{kalloc}:\textsf{Expr} \times \widehat{\textit{Env}} &\rightarrow \widehat{\textit{KAddr}} \\
    \widehat{kalloc}(e, \hat{\rho}) &\triangleq (e, \hat{\rho}) \\
  \end{align*}
  %%%%%%%%%%%%%%%%%%%%%%%%% STORE JOIN SEMANTICS %%%%%%%%%%%%%%%%%%%%%%%%%
  \begin{center}
    \textbf{Store Joining:} \\
    $\;\store \sqcup [\akaddr \mapsto \akont]
    \triangleq \store[\akaddr \mapsto \store(\akaddr) \cup \{\akont\}]$ \\
    $\store \sqcup [a \mapsto (\hat{cv}_i, \widehat{clo}_i)] \triangleq$ \\
    match on $\store[a]$
  \end{center}
  \[
    \store[a \mapsto \begin{cases}
      \texttt{empty}
      & (\hat{cv}_i, \widehat{clo}_i) \\
      (\bot, \widehat{clo}_e)
      & (\hat{cv}_i , \widehat{clo}_i \cup \widehat{clo}_e) \\
      (\hat{cv}_e, \widehat{clo}_e) \\
      \;\;\; \land \; \hat{cv}_i = \bot
      & (\hat{cv}_e , \widehat{clo}_i \cup \widehat{clo}_e)) \\
      (\hat{cv}_e , \widehat{clo}_e) \\
      \;\;\; \land \; \hat{cv}_i = \hat{cv}_e
      & (\hat{cv}_i , \widehat{clo}_i \cup \widehat{clo}_e) \\
      (\_, \widehat{clo}_e)
      & (\top , \widehat{clo}_i \cup \widehat{clo}_e) \\
    \end{cases}]
  \]
\end{multicols*}

\newpage

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%% BEGIN ABSTRACT EVAL SEMANTICS %%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\footnotesize{
\begin{multicols*}{2}
[
\begin{center}
\textbf{Abstract Eval Rules} \\
Rules for when the control is an expression \\
\vspace{2mm}
$\hat{\varsigma} = \E{\ectrl}{\aenv}{\astore}{\akaddr}$ \\
Proceed by matching on $\ectrl$ \\
%%%%%%%%%%%%%%%%%%%%%%%%% ATOMIC EVALUATION %%%%%%%%%%%%%%%%
\vspace{2mm}
$\mae \leadsto \A{\aval}{\astore}{\akaddr}$ \\
where $\aval \triangleq \hat{\mathcal{A}}(\hat{\varsigma})$
\end{center}
]
%%%%%%%%%%%%%%%%%%%%%%%%% IF EXPRESSION %%%%%%%%%%%%%%%%%%%%%%%%%
\begin{center}
  $ \ifsyn{e_c}{e_t}{e_f} $
  $\leadsto \E{e_c}{\aenv}{\astore'}{\akaddr}$
\end{center}
\vspace{-7mm}
\begin{align*}
  \text{where } \akaddr' &\triangleq \akalloc{\ectrl , \aenv} \\
  \akont &\triangleq \textbf{ifk}(e_t, e_f, \aenv , \akaddr) \\
  \astore' &\triangleq \astore \sqcup [\akaddr' \mapsto \akont]
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%% LET EXPRESSION NO ARGSVALS %%%%%%%%%%%%%%%%%%%
\begin{center}
  $(\texttt{let}\;()\;e_b)$
  $\leadsto \E{e_b}{\aenv}{\astore}{\akaddr}$
\end{center}
%%%%%%%%%%%%%%%%%%%%%%%%% LET EXPRESSION VALS GOT ARGS %%%%%%%%%%%%%%%
\begin{center}
  $(\texttt{let}\;bnds\;e_b)$
  $\leadsto \E{e_0}{\aenv}{\astore'}{\akaddr'}$
\end{center}
\vspace{-7mm}
\begin{align*}
  \text{where }
  bnds &= ([x_0\;e_0]\;[x_s\;e_s]\;...) \\
  \akaddr' &\triangleq \akalloc{\ectrl , \aenv} \\
  \akont &\triangleq \textbf{letk}(\ectrl, x_0::x_s , [\;], \\
  &\;\;\;\;\;\;\;\;\;\;\;\;\;e_s, e_b , \aenv , \akaddr) \\
  \astore' &\triangleq \astore \sqcup [\akaddr' \mapsto \akont]
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%% CALL/CC EXPRESSION %%%%%%%%%%%%%%%%%%%%%%%%%
\begin{center}
  $\callccsyn{e}$
  $\leadsto \E{e}{\aenv}{\astore'}{\akaddr'}$
\end{center}
\vspace{-7mm}
\begin{align*}
  \text{where }
  \akaddr' &\triangleq \akalloc{\ectrl , \aenv} \\
  \akont &\triangleq \textbf{callcck}(\ectrl , \aenv , \akaddr) \\
  \astore' &\triangleq \astore \sqcup [\akaddr' \mapsto \akont]
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%% SET EXPRESSION %%%%%%%%%%%%%%%%%%%%%%%%%
\begin{center}
  $\setsyn{x}{e}$
  $\leadsto \E{e}{\aenv}{\astore'}{\akaddr'}$
\end{center}
\vspace{-7mm}
\begin{align*}
  \text{where }
  \akaddr' &\triangleq \akalloc{\ectrl , \aenv} \\
  \abaddr &\triangleq \aenv(x) \\
  \akont &\triangleq \textbf{setk}(\abaddr , \akaddr) \\
  \astore' &\triangleq \astore \sqcup [\akaddr' \mapsto \akont]
\end{align*}


%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%% COLUMN BREAK %%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%
\vfill\null
\columnbreak
%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%% COLUMN BREAK %%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%% PRIM NO ARG EXPRESSION %%%%%%%%%%%%%%%%%%%%
\begin{center}
  $\singleprimsyn{op}$
  $\leadsto \A{\aval}{\astore}{\akaddr}$
\end{center}
\vspace{-7mm}
\begin{align*}
\text{where } \aval &= op \text{ applied to } 0 \text{ arguments}
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%% PRIM WITH ARGS EXPRESSION %%%%%%%%%%%%%%%%
\begin{center}
  $\primsyn{op}{e_0\;e_s}$
  $\leadsto \E{e_0}{\aenv}{\astore'}{\akaddr'}$
\end{center}
\vspace{-7mm}
\begin{align*}
  \text{where }
  \akaddr' &\triangleq \akalloc{\ectrl , \aenv} \\
  \akont &\triangleq \textbf{primk}(op , [\;] , e_s , \aenv , \akaddr) \\
  \astore' &\triangleq \astore \sqcup [\akaddr' \mapsto \akont]
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%% APPLY PRIM EXPRESSION %%%%%%%%%%%%%%%%
\begin{center}
  $\applyprimsyn{op}{e}$
  $\leadsto \E{e}{\aenv}{\astore'}{\akaddr'}$
\end{center}
\vspace{-7mm}
\begin{align*}
  \text{where }
  \akaddr' &\triangleq \akalloc{\ectrl , \aenv} \\
  \akont &\triangleq \textbf{appprimk}(op, \akaddr) \\
  \astore' &\triangleq \astore \sqcup [\akaddr' \mapsto \akont]
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%% APPLY FUNCTION LIST EXPRESSION %%%%%%%%%%%%%%%%
\begin{center}
  $\applysyn{e_f}{e_x}$
  $\leadsto \E{e_f}{\aenv}{\astore'}{\akaddr'}$
\end{center}
\vspace{-7mm}
\begin{align*}
  \text{where }
  \akaddr' &\triangleq \akalloc{\ectrl , \aenv} \\
  \akont &\triangleq \textbf{appappk}(\ectrl,\varnothing , e_x , \aenv , \akaddr) \\
  \astore' &\triangleq \astore \sqcup [\akaddr' \mapsto \akont]
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%% APPLICATION EXPRESSION %%%%%%%%%%%%%%%%
\begin{center}
  $(e_f\;e_s\;...)$
  $\leadsto \E{e_f}{\aenv}{\astore'}{\akaddr'}$
\end{center}
\vspace{-7mm}
\begin{align*}
  \text{where }
  \akaddr' &\triangleq \akalloc{\ectrl , \aenv} \\
  \akont &\triangleq \textbf{appk}(\ectrl , [\;] , e_s , \aenv , \akaddr) \\
  \astore' &\triangleq \astore \sqcup [\akaddr' \mapsto \akont]
\end{align*}
\end{multicols*}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%% ABSTRACT APPLY SEMANTICS %%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%% Page 1 %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage

\begin{multicols*}{2}
[
\begin{center}
\textbf{Apply Rules} \\
Rules for when the control is a value \\
$\hat{\varsigma} = A\langle \aval , \astore , \actrladdr \rangle$ \\
$\actrlkont \in \astore(\actrladdr) $ \\
Proceed by matching on $\actrlkont$ \\
%%%%%%%%%%%%%%%%%%%%%%%%% EMPTY KONT %%%%%%%%%%%%%%%%%%%%%%%%%
\vspace{5mm}
$\textbf{mt} \leadsto \emptyset$
\end{center}
\vspace{-5mm}
]
%%%%%%%%%%%%%%%%%%%%%%%%% IF KONT FALSE %%%%%%%%%%%%%%%%%%%%%%%%%
\begin{center}
  $\textbf{ifk}(\_ , e_f, \aenv_{\akont} , \akaddr)$
  $\leadsto \{\E{e_f}{\aenv_{\akont}}{\astore}{\akaddr}\}$
\end{center}
\vspace{-7mm}
\begin{align*}
\text{where } \aval &= (\falsesyn, \emptyset)
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%% IF KONT TRUE %%%%%%%%%%%%%%%%%%%%%%%%%
\begin{center}
  $\textbf{ifk}(e_t , \_ , \aenv_{\akont} , \akaddr)$
  $\leadsto \{\E{e_t}{\aenv_{\akont}}{\astore}{\akaddr}\}$
\end{center}
\vspace{-7mm}
\begin{align*}
  \text{where } \aval &= (not\;\falsesyn\;nor\;\top , \_)
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%% IF KONT BOTH %%%%%%%%%%%%%%%%%%%%%%%%%
\begin{center}
  $\textbf{ifk}(e_t , e_f , \aenv_{\akont} , \akaddr)$
  $\leadsto \{\E{e_t}{\aenv_{\akont}}{\astore}{\akaddr},
              \E{e_f}{\aenv_{\akont}}{\astore}{\akaddr}\}$
\end{center}
\vspace{-7mm}
\begin{align*}
\text{where } \aval &\in \{(\falsesyn, not\;\emptyset) , (\top, \_)\}
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%% LET KONT DONE %%%%%%%%%%%%%%%%%%%%%%%%%
\begin{center}
  $\textbf{letk}(\ectrl, vars, \adone, [\;], e_b,\aenv_{\akont} , \akaddr)$
  $\leadsto \{\E{e_b}{\aenv_{\akont}'}{\astore'}{\akaddr}\}$
\end{center}
\vspace{-7mm}
\begin{align*}
  \text{where }
  \abaddr_i &\triangleq \aballoc{vars_i , \ectrl} \\
  \aenv_{\akont}' &\triangleq \aenv_{\akont}[vars_0 \mapsto \abaddr_0\;... \\
            &\;\;\;\;\;\;\;\;\;\, vars_{n-1} \mapsto \abaddr_{n-1}] \\
  \adone' &\triangleq \adone \mdoubleplus [\aval] \\
  \astore' &\triangleq \astore \sqcup [\abaddr_0 \mapsto \adone'_0 ... \\
  &\;\;\;\;\;\;\;\;\;\;\;\; \abaddr_{n-1} \mapsto \adone'_{n-1}]
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%% LET KONT MORE TODO %%%%%%%%%%%%%%%%%%%%%%%%%
\begin{center}
  $\textbf{letk}(\ectrl , vars , \adone , e_h::e_t , e_b,\aenv_{\akont} , \akaddr)$
  $\leadsto \{\E{e_h}{\aenv_{\akont}}{\astore'}{\akaddr'}\}$
\end{center}
\vspace{-7mm}
\begin{align*}
  \text{where }
  \akaddr' &\triangleq \akalloc{\ectrl, \aenv_{\akont}} \\
  \akont &\triangleq \textbf{letk}(\ectrl, vars , \adone \mdoubleplus [\aval], \\
  &\;\;\;\;\;\;\;\;\;\;\;\;\;\, e_t , e_b , \aenv_{\akont} , \akaddr) \\
  \astore' &\triangleq \astore \sqcup [\akaddr' \mapsto \akont]
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%% SET! KONT %%%%%%%%%%%%%%%%%%%%%%%%%
\begin{center}
  $\textbf{setk}(\abaddr , \akaddr)$
  $\leadsto \{\A{(\textit{Void} , \emptyset)}{\astore'}{\akaddr}\}$
\end{center}
\vspace{-7mm}
\begin{align*}
  \text{where }
  \astore' &\triangleq \astore \sqcup [ \abaddr \mapsto \aval ]
\end{align*}

%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%% COLUMN BREAK %%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%
\vfill\null
\columnbreak
%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%% COLUMN BREAK %%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%%%%%%% CALL/CC MULTIARG KONT %%%%%%%%%%%%%%%%%%%%%
\begin{center}
  $\textbf{callcck}(\ectrl , \akaddr)$
  $\leadsto \{\E{e_b}{\aenv_{\lambda}'}{\astore'}{\akaddr}\}$
\end{center}
\vspace{-7mm}
\begin{align*}
  \text{where }
  \aval &\ni (\_ , (\singlelamsyn{x}{e_b} , \aenv_{\lambda})) \\
  \abaddr &\triangleq \aballoc{x , \ectrl} \\
  \akont &\in \astore(\akaddr) \\
  \aenv_{\lambda}' &\triangleq \aenv_{\lambda}[x \mapsto \abaddr] \\
  \astore' &\triangleq \astore \sqcup [\abaddr \mapsto \akont]
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%% CALL/CC KONT ARG %%%%%%%%%%%%%%%%%%%%%%%%%
\begin{center}
  $\textbf{callcck}(\_, \_)$
  $\leadsto \{\A{\actrlkont}{\astore'}{\actrladdr}\}$
\end{center}
\vspace{-7mm}
\begin{align*}
  \text{where }
  \aval &= (\akont , \_) \\
  \astore' &\triangleq \astore \sqcup [\actrladdr \mapsto \akont]
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%% APPLY PRIM KONT %%%%%%%%%%%%%%%%%%%%%%%%%
\begin{center}
  $\textbf{appprimk}(op, \akaddr)$
  $\leadsto \{\A{\aval'}{\astore}{\akaddr}\}$
\end{center}
\vspace{-7mm}
\begin{align*}
  \text{where } \aval' &\triangleq op \text{ applied to } \aval
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%% PRIM KONT DONE %%%%%%%%%%%%%%%%%%
\begin{center}
  $\textbf{primk}(op, \adone, [\;], \_, \akaddr)$
  $\leadsto \{\A{\aval'}{\astore}{\akaddr}\}$
\end{center}
\vspace{-7mm}
\begin{align*}
  \text{where }\aval'&\triangleq op\text{ applied to }(\adone \mdoubleplus [\aval])
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%% PRIM KONT NOT DONE %%%%%%%%%%%%%%%%%%%%%%%%%
\begin{center}
  $\textbf{primk}(op, \adone , e_h::e_t , \aenv_{\akont} , \akaddr)$
  $\leadsto \{\E{e_h}{\aenv_{\akont}}{\astore'}{\akaddr'}\}$
\end{center}
\vspace{-7mm}
\begin{align*}
  \text{where }
  \akaddr' &\triangleq \akalloc{e_h , \aenv_{\akont}} \\
  \akont &\triangleq \textbf{primk}(op, \adone \mdoubleplus [\aval] \\
            &\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\; e_t , \aenv_{\akont} , \akaddr) \\
  \astore' &\triangleq \astore \sqcup [\akaddr' \mapsto \akont]
\end{align*}
\end{multicols*}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%% ABSTRACT APPLY SEMANTICS %%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%% PAGE 2 %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage

\begin{multicols*}{2}
[
\begin{center}
\textbf{More Apply Rules} \\
Rules for when the control is a value
\end{center}
]
%%%%%%%%%%%%%%%%%%%%%%%%% APPLY LIST DONE MULTIARG %%%%%%%%%%%%%%%%%%%%%%%%%
\begin{center}
  $\textbf{appappk}(\ectrl, \aval_f , \_, \_ , \akaddr)$
  $\leadsto \{\E{e_b}{\aenv_{\lambda}'}{\astore'}{\akaddr}\}$
\end{center}
\vspace{-7mm}
\begin{align*}
  \text{where }
  \aval_f &\ni (\lamsyn{x_s}{e_b} , \aenv_{\lambda}) \\
  \abaddr_i &\triangleq \aballoc{x_i , \ectrl} \\
  \aenv_{\lambda}' &\triangleq \aenv_{\lambda}[x_0 \mapsto \abaddr_0\;... \\
                        &\;\;\;\;\;\;\;\;\;\,x_{n-1} \mapsto \abaddr_{n-1}] \\
  \astore' &\triangleq \astore \sqcup [\abaddr_0 \mapsto \aval_0\;... \\
                        &\;\;\;\;\;\;\;\;\;\;\;\;\abaddr_{n-1} \mapsto \aval_{n-1}]
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%% APPLY LIST DONE VARARG %%%%%%%%%%%%%%%%%%%%%%%%%
\begin{center}
  $\textbf{appappk}(\ectrl, \aval_f, \_, \_, \akaddr)$
  $\leadsto \{\E{e_b}{\aenv_{\lambda}'}{\astore'}{\akaddr}\}$
\end{center}
\vspace{-7mm}
\begin{align*}
  \text{where }
  \aval_f &\ni (\vararglamsyn{x}{e_b} , \aenv_{\lambda}) \\
  \abaddr &\triangleq \aballoc{x , \ectrl} \\
  \aenv_{\lambda}' &\triangleq \aenv_{\lambda}[x \mapsto \abaddr] \\
  \astore' &\triangleq \astore \sqcup [\abaddr \mapsto \aval]
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%% APPLY LIST KONT TODO %%%%%%%%%%%%%%%%%
\begin{center}
  $\textbf{appappk}(\ectrl, \varnothing , e_x , \aenv_{\akont} , \akaddr)$
  $\leadsto \{\E{e_x}{\aenv_{\akont}}{\astore'}{\akaddr'}\}$
\end{center}
\vspace{-7mm}
\begin{align*}
  \text{where }
  \akaddr' &\triangleq \akalloc{e_x , \aenv_{\akont}} \\
  \akont &\triangleq \textbf{appappk}(\ectrl,\aval,e_x,\aenv_{\akont},\akaddr) \\
  \astore' &\triangleq \astore \sqcup [\akaddr' \mapsto \akont]
\end{align*}

%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%% COLUMN BREAK %%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%
\vfill\null
\columnbreak
%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%% COLUMN BREAK %%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%%%%%%% APPLICATION MULTIARG %%%%%%%%%%%%%%%%%%%%%%%%%
\begin{center}
  $\textbf{appk}(\ectrl, \aval_h::\aval_t , [\;] , \_ , \akaddr)$
  $\leadsto \{\E{e_b}{\aenv_{\lambda}'}{\astore'}{\akaddr}\}$
\end{center}
\vspace{-7mm}
\begin{align*}
  \text{where }
  \aval_h &\ni (\_ , (\lamsyn{x_s}{e_b} , \aenv_{\lambda})) \\
  \abaddr_i &\triangleq \aballoc{x_i , \ectrl}\\
  \aenv_{\lambda}' &\triangleq \aenv_{\lambda}[x_0 \mapsto \abaddr_0 ... \\
          &\;\;\;\;\;\;\;\;\;\,x_{n-1} \mapsto \abaddr_{n-1}] \\
  \aval_t' &\triangleq \aval_t \mdoubleplus [\aval] \\
  \astore' &\triangleq \astore \sqcup [\abaddr_0 \mapsto \aval_0' ... \\
          &\;\;\;\;\;\;\;\;\;\;\;\;\abaddr_{n-1} \mapsto \aval_{n-1}']
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%% APPLICATION VARARG %%%%%%%%%%%%%%%%%%%%%%%%%
\begin{center}
  $\textbf{appk}(\ectrl, \aval_h::\aval_t , [\;] , \_ , \akaddr)$
  $\leadsto \{\E{e_b}{\aenv_{\lambda}'}{\astore'}{\akaddr}\}$
\end{center}
\vspace{-7mm}
\begin{align*}
  \text{where }
  \aval_h &\ni (\_ , (\vararglamsyn{x}{e_b} , \aenv_{\lambda})) \\
  \abaddr &\triangleq \aballoc{x , \ectrl} \\
  \aenv_{\lambda}' &\triangleq \aenv_{\lambda}[x \mapsto \abaddr] \\
  \aval_t' &\triangleq \aval_t \mdoubleplus [\aval] \\
  \astore' &\triangleq \astore \sqcup [\abaddr \mapsto \aval_t']
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%% APPLICATION KONTINUATION %%%%%%%%%%%%%%%%%%%%%
\begin{center}
  $\textbf{appk}(\ectrl , [\aval_f] , [\;] . \aenv_{\akont} , \_)$
  $\leadsto \{\A{\aval}{\astore'}{\akaddr}\}$
\end{center}
\vspace{-7mm}
\begin{align*}
  \text{where }
  \aval_f &= (\akont_{\lambda} , \_) \\
  \akaddr &\triangleq \akalloc{\ectrl , \aenv_{\akont}} \\
  \astore' &\triangleq \astore \sqcup [\akaddr \mapsto \akont_{\lambda}]
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%% APPLICATION NOT DONE %%%%%%%%%%%%%%%%%%%%%%%%%
\begin{center}
  $\textbf{appk}(\ectrl , \adone , e_h::e_t , \aenv_{\akont} , \akaddr)$
  $\leadsto \{\E{e_h}{\aenv_{\akont}}{\astore'}{\akaddr'}\}$
\end{center}
\vspace{-7mm}
\begin{align*}
  \text{where }
  \akaddr' &\triangleq \akalloc{e_h , \aenv_{\akont}} \\
  \akont &\triangleq \textbf{appk}(\ectrl, \adone \mdoubleplus [\aval],
            e_t , \aenv_{\akont} , \akaddr) \\
  \astore' &\triangleq \astore \sqcup [\akaddr' \mapsto \akont]
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%% ITS OVER %%%%%%%%%%%%%%%%%%%%%%%%%
\end{multicols*}


\end{document}
